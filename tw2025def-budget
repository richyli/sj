<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±ºæˆ°æ™‚åˆ»ï¼šå®ˆè­·å°ç£çš„é—œéµ 5 åˆ†é˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --hud-primary: #00ff9d;
            --hud-danger: #ff3333;
            --hud-bg: #0a0f14;
            --hud-panel: rgba(16, 24, 32, 0.95);
            --scan-line-color: rgba(0, 255, 157, 0.1);
        }

        body {
            background-color: var(--hud-bg);
            color: #e0e0e0;
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            background-image: 
                linear-gradient(rgba(0, 20, 10, 0.8), rgba(0, 10, 20, 0.9)),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231a2633' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        /* Tech/HUD Fonts */
        .font-tech {
            font-family: 'Orbitron', sans-serif;
        }

        /* CRT Scanline Effect */
        .scanlines::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 50;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* HUD Borders & Glows */
        .hud-border {
            border: 1px solid var(--hud-primary);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.2);
            position: relative;
        }
        
        .hud-border::after {
            content: '';
            position: absolute;
            top: -2px; left: -2px;
            width: 10px; height: 10px;
            border-top: 2px solid var(--hud-primary);
            border-left: 2px solid var(--hud-primary);
        }
        .hud-border::before {
            content: '';
            position: absolute;
            bottom: -2px; right: -2px;
            width: 10px; height: 10px;
            border-bottom: 2px solid var(--hud-primary);
            border-right: 2px solid var(--hud-primary);
        }

        .hud-btn {
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid var(--hud-primary);
            color: var(--hud-primary);
            transition: all 0.3s ease;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            cursor: pointer;
        }
        .hud-btn:hover {
            background: var(--hud-primary);
            color: #000;
            box-shadow: 0 0 20px var(--hud-primary);
        }
        .hud-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        /* Radar Animation */
        .radar-sweep {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            background: conic-gradient(from 0deg, transparent 0deg, rgba(0, 255, 157, 0.5) 360deg);
            animation: radar-spin 4s linear infinite;
            mask-image: radial-gradient(circle, transparent 0%, black 100%);
            -webkit-mask-image: radial-gradient(circle, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 70%); 
            opacity: 0.3;
        }
        
        @keyframes radar-spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .blinking-dot {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Health Bar */
        .health-segment {
            transition: all 0.5s ease;
        }
        .health-lost {
            background-color: #333 !important;
            box-shadow: none !important;
            border-color: #555 !important;
        }

        /* Glitch Text Effect */
        .glitch-text {
            position: relative;
        }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .glitch-text::before {
            left: 2px;
            text-shadow: -1px 0 red;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        .glitch-text::after {
            left: -2px;
            text-shadow: -1px 0 blue;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip: rect(11px, 9999px, 83px, 0); }
            20% { clip: rect(96px, 9999px, 5px, 0); }
            40% { clip: rect(2px, 9999px, 48px, 0); }
            60% { clip: rect(66px, 9999px, 19px, 0); }
            80% { clip: rect(89px, 9999px, 93px, 0); }
            100% { clip: rect(26px, 9999px, 5px, 0); }
        }

        /* Modal Transitions */
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-exit {
            opacity: 1;
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center relative scanlines">

    <!-- Background Map Grid -->
    <div class="fixed inset-0 z-0 opacity-20 pointer-events-none" style="background-image: radial-gradient(var(--hud-primary) 1px, transparent 1px); background-size: 40px 40px;"></div>

    <!-- MAIN GAME CONTAINER -->
    <main id="game-container" class="relative z-10 w-full max-w-4xl p-4 md:p-8">
        
        <!-- INTRO SCREEN -->
        <div id="intro-screen" class="hud-border bg-gray-900/90 p-8 md:p-12 text-center backdrop-blur-sm">
            <div class="mb-6 inline-block border border-green-500/30 p-2 rounded-full">
                <span class="text-green-400 font-tech text-sm tracking-widest">DEFENSE SIMULATION V2.026</span>
            </div>
            <h1 class="text-4xl md:text-6xl font-bold mb-4 text-white tracking-tight glitch-text" data-text="æ±ºæˆ°æ™‚åˆ»ï¼šå®ˆè­·å°ç£">
                æ±ºæˆ°æ™‚åˆ»ï¼šå®ˆè­·å°ç£
            </h1>
            <p class="text-xl md:text-2xl text-gray-300 mb-8 font-light">
                ä½ æ˜¯æŒ‡æ®å®˜ï¼Œä½ çš„æ¯å€‹æ±ºå®šéƒ½å°‡å½±éŸ¿ 2300 è¬äººçš„å‘½é‹ã€‚
            </p>
            <div class="text-left bg-black/40 p-6 rounded mb-8 border-l-4 border-green-500">
                <h3 class="text-green-400 font-bold mb-2 font-tech">MISSION BRIEFING</h3>
                <ul class="space-y-3 text-gray-400 text-sm md:text-base">
                    <li class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>åˆå§‹é˜²è¡›å€¼ï¼š<span class="text-white font-bold ml-1">10</span> åˆ†</li>
                    <li class="flex items-center"><span class="w-2 h-2 bg-yellow-500 rounded-full mr-3"></span>ä½œæˆ°ç›®æ¨™ï¼šæŠµç¦¦ 5 æ³¢ç¾ä»£åŒ–æ”»å‹¢</li>
                    <li class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-3"></span>å¤±æ•—æ¢ä»¶ï¼šé˜²è¡›å€¼è·Œè‡³ 5 åˆ†ä»¥ä¸‹ï¼ˆå³å¤±æ•— 3 æ¬¡ï¼‰</li>
                    <li class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-3"></span>æ‡²ç½°ï¼šéŒ¯èª¤æ±ºç­–å°‡æ‰£é™¤ 2 åˆ†</li>
                </ul>
            </div>
            <button onclick="startGame()" class="hud-btn w-full md:w-auto px-12 py-4 text-xl font-bold uppercase tracking-widest">
                å•Ÿå‹•æˆ°æ£‹æ¨æ¼”
            </button>
        </div>

        <!-- GAMEPLAY SCREEN (Hidden by default) -->
        <div id="game-screen" class="hidden flex flex-col gap-6">
            
            <!-- HUD Header -->
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 bg-black/60 border-b border-green-500/30 p-4">
                <div class="flex items-center gap-4">
                    <div class="text-xs font-tech text-gray-500">SYSTEM STATUS</div>
                    <div class="flex items-center gap-2">
                        <span class="relative flex h-3 w-3">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                        </span>
                        <span class="text-red-500 font-bold tracking-widest animate-pulse">DEFCON 1</span>
                    </div>
                </div>
                
                <!-- Health Bar -->
                <div class="w-full md:w-1/2">
                    <div class="flex justify-between text-xs text-green-400 mb-1 font-tech">
                        <span>DEFENSE INTEGRITY</span>
                        <span id="health-text">100%</span>
                    </div>
                    <div class="flex gap-1 h-4" id="health-bar-container">
                        <!-- Segments generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Visualization Area (Radar/Map) -->
            <div class="relative h-48 md:h-64 bg-gray-900 border border-gray-700 overflow-hidden flex items-center justify-center">
                <!-- Grid -->
                <div class="absolute inset-0" style="background-image: linear-gradient(rgba(0, 255, 157, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 157, 0.1) 1px, transparent 1px); background-size: 20px 20px;"></div>
                <!-- Radar Circle -->
                <div class="relative w-40 h-40 md:w-56 md:h-56 rounded-full border border-green-500/30">
                    <div class="radar-sweep"></div>
                    <!-- Central Taiwan Icon (Abstract) -->
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 h-8 bg-green-600 blur-sm"></div>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-6 bg-white"></div>
                    
                    <!-- Dynamic Threats (Injected by JS) -->
                    <div id="radar-threats"></div>
                </div>
                
                <!-- Overlay Text -->
                <div class="absolute top-2 left-4 text-xs font-tech text-green-700">
                    SATELLITE UPLINK: ACTIVE<br>
                    TARGET TRACKING: ENGAGED
                </div>
            </div>

            <!-- Scenario Text -->
            <div class="hud-border bg-gray-900/80 p-6 min-h-[180px]">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-red-500 font-tech text-sm">INCOMING THREAT //</span>
                    <h2 id="scenario-title" class="text-xl md:text-2xl font-bold text-white"></h2>
                </div>
                <p id="scenario-desc" class="text-gray-300 leading-relaxed"></p>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Removed specific colors and labels to make them neutral -->
                <button onclick="makeChoice(0)" id="btn-option-a" class="hud-btn p-6 text-left group relative overflow-hidden">
                    <div class="relative z-10">
                        <span class="block text-xs uppercase tracking-widest opacity-70 mb-1 group-hover:text-white">Option A</span>
                        <span id="text-option-a" class="text-lg font-bold"></span>
                    </div>
                </button>

                <button onclick="makeChoice(1)" id="btn-option-b" class="hud-btn p-6 text-left group relative overflow-hidden">
                    <div class="relative z-10">
                        <span class="block text-xs uppercase tracking-widest opacity-70 mb-1 group-hover:text-white">Option B</span>
                        <span id="text-option-b" class="text-lg font-bold"></span>
                    </div>
                </button>
            </div>
        </div>

        <!-- RESULT MODAL (Overlay) -->
        <div id="result-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 hidden opacity-0 transition-opacity duration-300">
            <div class="bg-gray-900 border-2 border-white w-full max-w-2xl p-1 shadow-2xl transform scale-95 transition-transform duration-300" id="modal-content">
                <div class="bg-black p-6 md:p-8 h-full relative overflow-hidden">
                    <!-- Decor -->
                    <div class="absolute top-0 right-0 w-16 h-16 border-t-4 border-r-4 border-white/20 rounded-tr-xl"></div>
                    <div class="absolute bottom-0 left-0 w-16 h-16 border-b-4 border-l-4 border-white/20 rounded-bl-xl"></div>
                    
                    <h3 id="modal-title" class="text-3xl font-bold mb-4 font-tech uppercase"></h3>
                    
                    <!-- Analysis Box -->
                    <div class="bg-gray-800/50 p-4 border-l-4 mb-6" id="modal-border-color">
                        <h4 class="font-bold text-gray-200 mb-2 text-sm uppercase tracking-widest">æˆ°è¡“åˆ†æå ±å‘Š</h4>
                        <p id="modal-feedback" class="text-gray-300 leading-relaxed text-sm md:text-base"></p>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="text-sm font-tech text-gray-500" id="modal-status-code">CODE: 404-FAIL</div>
                        <button id="modal-next-btn" onclick="nextLevel()" class="bg-white text-black hover:bg-gray-200 px-6 py-2 font-bold uppercase tracking-widest text-sm transition-colors">
                            æŒ‡æ®å®˜ï¼Œä¸‹ä¸€æ³¢æ”»æ“Šä¾†äº† >>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ENDING SCREEN -->
        <div id="ending-screen" class="hidden hud-border bg-gray-900/95 p-8 md:p-12 text-center">
            <div id="ending-icon" class="text-6xl mb-6"></div>
            <h2 id="ending-title" class="text-4xl md:text-5xl font-bold mb-6 text-white tracking-tight"></h2>
            <div class="w-full h-px bg-gray-700 my-6"></div>
            <p id="ending-desc" class="text-lg text-gray-300 leading-relaxed mb-8 max-w-2xl mx-auto"></p>
            
            <div id="ending-stats" class="grid grid-cols-2 gap-4 max-w-lg mx-auto mb-8 text-left bg-black/30 p-4 rounded border border-gray-700">
                <!-- Stats injected here -->
            </div>

            <button onclick="location.reload()" class="hud-btn px-8 py-3 text-sm font-bold uppercase tracking-widest">
                é‡æ–°å•Ÿå‹•æ¨¡æ“¬
            </button>
        </div>

    </main>

    <script>
        // --- GAME STATE ---
        const gameState = {
            currentStage: 0,
            maxStages: 5,
            defenseScore: 10,
            scoreThreshold: 5,
            history: [],
            currentRoundOptions: [] // Added to store shuffled options
        };

        // --- SCENARIO DATA ---
        const scenarios = [
            {
                id: 1,
                title: "ç°è‰²åœ°å¸¶èˆ‡ç„¡äººæ©Ÿé£½å’Œæ”»æ“Š",
                desc: "é›·é”è­¦å ±ï¼ç¦å»ºæ²¿æµ·å‡ç©ºè¶…é 300 æ¶ä¸æ˜é£›è¡Œç‰©ï¼Œæ­£ä½ç©ºå¿«é€Ÿæ¥è¿‘æˆ‘æ–¹é›·é”ç«™ã€‚é€™æ˜¯å…¸å‹çš„ã€Œç„¡äººæ©Ÿèœ‚ç¾¤ã€é£½å’Œæ”»æ“Šï¼Œä¼åœ–æ¶ˆè€—æˆ‘æ–¹é˜²ç©ºè³‡æºã€‚",
                threatVisual: `<div class="absolute top-1/4 right-1/4 w-2 h-2 bg-red-500 rounded-full blinking-dot"></div>
                               <div class="absolute top-1/3 right-1/3 w-2 h-2 bg-red-500 rounded-full blinking-dot" style="animation-delay: 0.2s"></div>
                               <div class="absolute top-1/2 right-1/4 w-2 h-2 bg-red-500 rounded-full blinking-dot" style="animation-delay: 0.4s"></div>
                               <div class="absolute bottom-1/3 right-1/3 w-2 h-2 bg-red-500 rounded-full blinking-dot" style="animation-delay: 0.1s"></div>`,
                options: [
                    {
                        text: "å‘½ä»¤æ„›åœ‹è€…é£›å½ˆå…¨æ•¸é–‹ç«ï¼Œå‹™å¿…æ“Šè½æ‰€æœ‰ç›®æ¨™ï¼",
                        isCorrect: false,
                        feedback: "éŒ¯èª¤ï¼é›–ç„¶æ“Šè½äº†éƒ¨åˆ†ç„¡äººæ©Ÿï¼Œä½†æˆ‘æ–¹ä¸€æšæ•¸åƒè¬çš„é˜²ç©ºé£›å½ˆè€—ç›¡ï¼Œåªæ›æ‰å°æ–¹å»‰åƒ¹ç„¡äººæ©Ÿã€‚å¾ŒçºŒä¸»åŠ›æˆ°æ©Ÿé€²çŠ¯æ™‚ï¼Œæˆ‘æ–¹å·²ç„¡å½ˆè—¥å¯ç”¨ã€‚",
                        policyNote: "å°ç£ç›®å‰ç¼ºä¹è¶³å¤ çš„ä½æˆæœ¬ååˆ¶ç³»çµ±ï¼ˆå¦‚è»Ÿæ®ºå¹²æ“¾æˆ–é›·å°„ï¼‰ï¼Œè‹¥ç”¨æ˜‚è²´é£›å½ˆç¡¬ç¢°ç¡¬å°‡ç„¡æ³•æŒä¹…ã€‚æˆ‘å€‘éœ€è¦é€™ç­†é ç®—ä¾†æ¡è³¼å°ˆé–€çš„ç„¡äººæ©Ÿååˆ¶ç³»çµ±ã€‚"
                    },
                    {
                        text: "å•Ÿå‹•ã€Œååˆ¶ç³»çµ±ã€é›»å­å¹²æ“¾ï¼Œä¸¦æ´¾å‡ºç„¡äººæ©Ÿæ””æˆªã€‚",
                        isCorrect: true,
                        feedback: "æ­£ç¢ºï¼é›»å­å¹²æ“¾ç¶²æˆåŠŸç™±ç˜“æ•µæ–¹ç„¡äººæ©Ÿç¾¤ï¼Œæˆ‘æ–¹ç„¡äººæ©Ÿå‡ç©ºè£œä½ã€‚é‡è¦è¨­æ–½å®Œå¥½ï¼Œä¸”ä¸»åŠ›é£›å½ˆåº«å­˜å……è¶³ã€‚",
                        policyNote: "é€™å°±æ˜¯ã€Œä¸å°ç¨±æˆ°åŠ›ã€ã€‚åˆ©ç”¨é ç®—æ¡è³¼çš„ååˆ¶ç³»çµ±ï¼ŒæˆåŠŸä»¥ä½æˆæœ¬å®ˆä½äº†é«˜åƒ¹å€¼ç›®æ¨™ã€‚"
                    }
                ]
            },
            {
                id: 2,
                title: "æµ·ç©ºå°é–èˆ‡å­¤å³¶å±æ©Ÿ",
                desc: "å…±è»å®£ä½ˆåœ¨å°ç£å‘¨é‚Šæµ·åŸŸå¯¦å½ˆæ¼”ç¿’ï¼Œå½¢æˆã€Œå…¨å³¶å°é–ã€ã€‚å¤©ç„¶æ°£èˆ¹ç„¡æ³•é€²æ¸¯ï¼Œèƒ½æºèˆ‡ç‰©è³‡åƒ…å‰© 10 å¤©å­˜é‡ã€‚æ•µè»ä¼åœ–ä¸æˆ°è€Œå±ˆäººä¹‹å…µã€‚",
                threatVisual: `<div class="absolute inset-0 border-4 border-red-500/50 rounded-full animate-pulse"></div>`,
                options: [
                    {
                        text: "æ´¾å‡ºæ‰€æœ‰å¤§å‹é©…é€è‰¦ï¼Œæ­£é¢è¡ç ´å°é–ç·šï¼",
                        isCorrect: false,
                        feedback: "éŒ¯èª¤ï¼å¤§å‹è»è‰¦å‡ºæ¸¯å¾Œæˆç‚ºæ•µæ–¹è¡›æ˜Ÿèˆ‡é•·ç¨‹é£›å½ˆçš„æ´»é¶ï¼Œæå¤±æ…˜é‡ä¸”ç„¡æ³•è§£é™¤å°é–ã€‚èƒ½æºè€—ç›¡ï¼Œç¤¾æœƒå‹•ç›ªã€‚",
                        policyNote: "å°ç£ç›®å‰è‰¦è‰‡æ•¸é‡èˆ‡å™¸ä½ä¸åŠå°æ–¹ï¼Œç¡¬ç¢°ç¡¬å¿…æ•—ã€‚æˆ‘å€‘éœ€è¦æ–°é ç®—ä¾†å¼·åŒ–åœ‹å…§è‡ªä¸»ç”Ÿç”¢å½ˆè—¥èˆ‡ç‰©è³‡çš„èƒ½åŠ›ï¼Œä¸¦éƒ¨ç½²æ©Ÿå‹•é£›å½ˆï¼Œæ‰èƒ½åœ¨å°é–ä¸­ç”Ÿå­˜ã€‚"
                    },
                    {
                        text: "éƒ¨ç½²ã€Œå²¸ç½®é ç¨‹é£›å½ˆã€å£“åˆ¶ï¼Œä¸¦å•Ÿå‹•åœ‹å…§æˆ°å‚™ç”¢ç·šã€‚",
                        isCorrect: true,
                        feedback: "æ­£ç¢ºï¼å²¸ç½®é£›å½ˆè¿«ä½¿æ•µè‰¦å¾Œæ’¤ï¼Œå°é–ç·šå‡ºç¾ç ´å£ã€‚åŒæ™‚åœ‹å…§å…µå·¥ç”¢ç·šå…¨é–‹ï¼Œè£œçµ¦ä¸ä¸­æ–·ï¼Œç¤¾æœƒäººå¿ƒç©©å®šã€‚",
                        policyNote: "æ‚¨é‹ç”¨äº†ã€Œé‡å±¤æ””æˆªã€èˆ‡ã€Œé˜²è¡›éŸŒæ€§ã€ã€‚é€™ç­†é ç®—æŠ•è³‡çš„åœ‹å…§ä¾›æ‡‰éˆï¼Œè®“æˆ‘å€‘èƒ½æ’å¾—æ¯”æ•µäººä¹…ã€‚"
                    }
                ]
            },
            {
                id: 3,
                title: "å…©æ£²ç™»é™¸èˆ‡é€šè¨Šæ–¬é¦–",
                desc: "æ•µè»æº–å‚™æ¶ç˜ç™»é™¸ã€‚åŒæ™‚ï¼Œé§­å®¢åˆ‡æ–·é€šè¨Šå…‰çº–ï¼ŒæŒ‡æ®ä¸­å¿ƒè¢å¹•ä¸€ç‰‡æ¼†é»‘ï¼Œå‰ç·šéƒ¨éšŠæ”¶ä¸åˆ°æŒ‡ä»¤ï¼Œé™·å…¥æ··äº‚ã€‚",
                threatVisual: `<div class="absolute top-1/2 left-1/2 w-full h-1 bg-red-500 transform -translate-x-1/2 rotate-45"></div>
                               <div class="absolute top-1/2 left-1/2 w-full h-1 bg-red-500 transform -translate-x-1/2 -rotate-45"></div>`,
                options: [
                    {
                        text: "ä¾é å„éƒ¨éšŠè‡ªç”±ç™¼æ®ï¼Œå‘½ä»¤å¦å…‹ç›´æ¥é–‹å¾€æµ·ç˜æ±ºæˆ°ã€‚",
                        isCorrect: false,
                        feedback: "éŒ¯èª¤ï¼ç¼ºä¹æƒ…å ±æ•´åˆï¼Œéƒ¨éšŠå„è‡ªç‚ºæ”¿ã€‚å¦å…‹åœ¨ç§»å‹•ä¸­è¢«æ‘§æ¯€ï¼Œæ•µè»æˆåŠŸç™»é™¸ï¼Œæˆ°ç«ç‡’é€²åŸé®ã€‚",
                        policyNote: "å°ç£ç›®å‰çš„é€šè¨Šç³»çµ±åœ¨é¢å°é«˜å¼·åº¦é›»å­æˆ°æ™‚å¯èƒ½å¤±æ•ˆã€‚æˆ‘å€‘æ€¥éœ€é ç®—æ¡è³¼ AI è¼”åŠ©æŒ‡æ®ç³»çµ±ï¼Œæ‰èƒ½åœ¨é€šè¨Šæ··äº‚ä¸­è¿…é€Ÿæ•´åˆæˆ°å ´æƒ…å ±ã€‚"
                    },
                    {
                        text: "å•Ÿå‹•ã€ŒAI æŒ‡æ®ç³»çµ±ã€æ•´åˆæƒ…å ±ï¼Œåˆ©ç”¨ç²¾æº–ç«ç ²æºé ­æ‰“æ“Šã€‚",
                        isCorrect: true,
                        feedback: "æ­£ç¢ºï¼AI è¿…é€Ÿæ•´åˆç„¡äººæ©Ÿæ•¸æ“šï¼Œæ¨™å®šä½ç½®ã€‚æˆ‘æ–¹ç²¾æº–ç«ç ²åœ¨æ•µè»ä¸Šå²¸å‰å°±æ‘§æ¯€å…¶ä¸»åŠ›ï¼Œç™»é™¸å¤±æ•—ã€‚",
                        policyNote: "é€éæ¡è³¼ AI ç³»çµ±èˆ‡ç²¾æº–å½ˆè—¥ï¼Œèƒ½åŠ é€Ÿã€Œæ“Šæ®ºéˆã€ï¼Œå°‡æˆ°ç«é˜»çµ•åœ¨å¢ƒå¤–ã€‚"
                    }
                ]
            },
            {
                id: 4,
                title: "æ•µè»è£ç”²éƒ¨éšŠæ¶ç˜",
                desc: "æ•µè»å…©æ£²çªæ“Šè»Šçªç ´é˜²ç·šï¼Œæ•¸ç™¾è¼›å¦å…‹å³å°‡ç™»é™¸ã€‚æˆ‘æ–¹ç˜å²¸å®ˆå‚™å…µåŠ›é¢è‡¨æ¥µå¤§å£“åŠ›ã€‚",
                threatVisual: `<div class="absolute bottom-1/4 left-1/2 w-3 h-3 bg-red-600 rounded-sm animate-bounce"></div>
                               <div class="absolute bottom-1/4 left-1/3 w-3 h-3 bg-red-600 rounded-sm animate-bounce" style="animation-delay: 0.1s"></div>
                               <div class="absolute bottom-1/4 right-1/3 w-3 h-3 bg-red-600 rounded-sm animate-bounce" style="animation-delay: 0.2s"></div>`,
                options: [
                    {
                        text: "æ´¾é£ä¸»åŠ›æˆ°è»Šç‡Ÿå‰å¾€ç˜å²¸é€²è¡Œè¿‘è·é›¢ç ²æˆ°ã€‚",
                        isCorrect: false,
                        feedback: "éŒ¯èª¤ï¼åœ¨æ•µæ–¹æŒæ¡ç©ºå„ªçš„æƒ…æ³ä¸‹ï¼Œé›†çµçš„æˆ°è»Šéƒ¨éšŠå®¹æ˜“æˆç‚ºæ”»æ“Šç›´å‡æ©Ÿçš„ç›®æ¨™ï¼Œä¸”æˆ°æäº¤æ›æ¯”æ¥µä¸åˆ’ç®—ã€‚",
                        policyNote: "å‚³çµ±å¦å…‹å°æ±ºä»£åƒ¹å¤ªé«˜ã€‚å°ç£ç›®å‰ç¼ºä¹è¶³å¤ æ•¸é‡çš„æ–°å¼å–®å…µåè£ç”²æ­¦å™¨èˆ‡éŠè•©å½ˆè—¥ï¼ˆè‡ªæ®ºç„¡äººæ©Ÿï¼‰ï¼Œéœ€è¦æ–°é ç®—ä¾†å¡«è£œé€™äº›ä¸å°ç¨±æˆ°åŠ›ã€‚"
                    },
                    {
                        text: "é‹ç”¨ã€Œåè£ç”²é£›å½ˆã€èˆ‡éŠè•©å½ˆè—¥é€²è¡Œæ©Ÿå‹•ä¼æ“Šã€‚",
                        isCorrect: true,
                        feedback: "æ­£ç¢ºï¼åˆ©ç”¨åœ°å½¢æ©è­·ï¼Œä»¥å–®å…µé£›å½ˆèˆ‡è‡ªæ®ºç„¡äººæ©Ÿç²¾æº–æ‘§æ¯€æ•µè»å¦å…‹ï¼Œæ•µè»æ”»å‹¢å—é˜»ï¼Œç„¡æ³•å»ºç«‹ç˜é ­å ¡ã€‚",
                        policyNote: "åˆ©ç”¨é«˜æ©Ÿå‹•æ€§çš„åè£ç”²é£›å½ˆï¼Œè®“æ•µè»å¦å…‹æˆç‚ºå»¢éµã€‚é€™å°±æ˜¯é ç®—ä¸­å¼·èª¿çš„ã€Œå¤šå±¤æ¬¡å‰Šå¼±ã€æˆ°è¡“ã€‚"
                    }
                ]
            },
            {
                id: 5,
                title: "æ•µè»é›†çµèˆ‡æºé ­æ‰“æ“Š",
                desc: "è¡›æ˜Ÿåµæ¸¬åˆ°å°å²¸æ¸¯å£é›†çµå¤§é‡ç™»é™¸èˆ¹åœ˜èˆ‡ç‰©è³‡ï¼Œæº–å‚™ç™¼å‹•ç¸½æ”»æ“Šã€‚é€™æ˜¯æ•µè»æœ€è„†å¼±çš„æ™‚åˆ»ã€‚",
                threatVisual: `<div class="absolute top-0 right-0 w-16 h-16 border-l-2 border-b-2 border-red-500/50 rounded-bl-3xl"></div>`,
                options: [
                    {
                        text: "å›ºå®ˆæœ¬å³¶ï¼Œç­‰å¾…æ•µè»é€²çŠ¯å¾Œå†åæ“Šã€‚",
                        isCorrect: false,
                        feedback: "éŒ¯èª¤ï¼è¢«å‹•é˜²ç¦¦æœƒè®“æˆ°ç«åœ¨æœ¬åœŸç‡ƒç‡’ï¼Œé€ æˆå¹³æ°‘é‡å¤§å‚·äº¡ï¼Œä¸”ä¸€æ—¦æ•µè»ç™»é™¸ï¼Œé˜²å®ˆé›£åº¦å°‡å€å¢ã€‚",
                        policyNote: "éå»æˆ‘å€‘ç¼ºä¹é•·ç¨‹æ‰“æ“Šèƒ½åŠ›ï¼Œåªèƒ½è¢«å‹•æŒ¨æ‰“ã€‚ç¾åœ¨éœ€è¦æ–°é ç®—æ¡è³¼ã€Œé ç¨‹ç²¾æº–æ‰“æ“Šé£›å½ˆã€ï¼Œå»ºç«‹ã€Œåªè¦ä½ æ•¢é›†çµï¼Œæˆ‘å°±èƒ½æ‰“å¾—åˆ°ã€çš„åš‡é˜»åŠ›ã€‚"
                    },
                    {
                        text: "ä½¿ç”¨ã€Œé ç¨‹ç²¾æº–æ‰“æ“Šé£›å½ˆã€æ”»æ“Šæ•µæ–¹é›†çµæ¸¯å£èˆ‡è£œçµ¦åº«ã€‚",
                        isCorrect: true,
                        feedback: "æ­£ç¢ºï¼æ•µæ–¹æ¸¯å£é™·å…¥ç«æµ·ï¼Œç™»é™¸èˆ¹åœ˜åœ¨å‡ºç™¼å‰å³å—é‡å‰µï¼Œé€²æ”»è¨ˆç•«è¢«è¿«å»¶å¾Œæˆ–å–æ¶ˆã€‚",
                        policyNote: "é€™å°±æ˜¯ã€Œæºé ­æ‰“æ“Šã€ã€‚é€éæ¡è³¼æ¡ˆä¸­çš„é ç¨‹é£›å½ˆï¼Œæˆ‘å€‘å°‡é˜²è¡›ç¸±æ·±æ¨å‘å°å²¸ï¼Œç¢ºä¿å°ç£æœ¬å³¶å®‰å…¨ã€‚"
                    }
                ]
            }
        ];

        // --- DOM ELEMENTS ---
        const screens = {
            intro: document.getElementById('intro-screen'),
            game: document.getElementById('game-screen'),
            ending: document.getElementById('ending-screen')
        };
        const els = {
            healthBar: document.getElementById('health-bar-container'),
            healthText: document.getElementById('health-text'),
            radarThreats: document.getElementById('radar-threats'),
            scenarioTitle: document.getElementById('scenario-title'),
            scenarioDesc: document.getElementById('scenario-desc'),
            btnA: document.getElementById('btn-option-a'),
            btnB: document.getElementById('btn-option-b'),
            textA: document.getElementById('text-option-a'),
            textB: document.getElementById('text-option-b'),
            modal: document.getElementById('result-modal'),
            modalContent: document.getElementById('modal-content'),
            modalTitle: document.getElementById('modal-title'),
            modalFeedback: document.getElementById('modal-feedback'),
            modalBorder: document.getElementById('modal-border-color'),
            modalStatus: document.getElementById('modal-status-code'),
            modalNextBtn: document.getElementById('modal-next-btn')
        };

        // --- FUNCTIONS ---

        function initHealthBar() {
            els.healthBar.innerHTML = '';
            for(let i=0; i<5; i++) {
                const seg = document.createElement('div');
                seg.className = 'flex-1 bg-green-500 rounded-sm shadow-[0_0_10px_#00ff9d] health-segment';
                els.healthBar.appendChild(seg);
            }
        }

        function updateHealthDisplay() {
            const percentage = (gameState.defenseScore / 10) * 100;
            els.healthText.innerText = `${percentage}%`;
            
            // 10 points = 5 segments. Each segment = 2 points.
            const segments = els.healthBar.children;
            const activeSegments = Math.ceil(gameState.defenseScore / 2);

            for(let i=0; i<5; i++) {
                if (i < activeSegments) {
                    segments[i].classList.remove('health-lost');
                    // Color change based on health
                    if(activeSegments <= 2) {
                        segments[i].classList.remove('bg-green-500', 'shadow-[0_0_10px_#00ff9d]');
                        segments[i].classList.add('bg-red-600', 'shadow-[0_0_10px_#ff0000]');
                    }
                } else {
                    segments[i].classList.add('health-lost');
                }
            }
        }

        function startGame() {
            gameState.currentStage = 0;
            gameState.defenseScore = 10;
            gameState.history = [];
            
            screens.intro.classList.add('hidden');
            screens.game.classList.remove('hidden');
            screens.ending.classList.add('hidden');
            
            initHealthBar();
            loadScenario(0);
        }

        function loadScenario(index) {
            if(index >= scenarios.length) {
                endGame();
                return;
            }

            const data = scenarios[index];
            
            // Randomize options for this round
            // We create a shallow copy and sort randomly
            gameState.currentRoundOptions = [...data.options].sort(() => Math.random() - 0.5);

            // Content
            els.scenarioTitle.innerText = `SCENARIO 0${index+1}: ${data.title}`;
            els.scenarioDesc.innerText = data.desc;
            
            // Assign shuffled options to buttons
            els.textA.innerText = gameState.currentRoundOptions[0].text;
            els.textB.innerText = gameState.currentRoundOptions[1].text;
            
            // Visuals
            els.radarThreats.innerHTML = data.threatVisual;

            // Reset buttons state
            els.btnA.disabled = false;
            els.btnB.disabled = false;
        }

        function makeChoice(optionIndex) {
            // Retrieve the option from our randomized array
            const choice = gameState.currentRoundOptions[optionIndex];
            
            // Logic
            if(!choice.isCorrect) {
                gameState.defenseScore -= 2;
                showModal(false, choice.feedback, choice.policyNote);
            } else {
                showModal(true, choice.feedback, choice.policyNote);
            }

            updateHealthDisplay();

            // Check immediate fail state or update history
            gameState.history.push({
                stage: gameState.currentStage + 1,
                result: choice.isCorrect ? "SUCCESS" : "FAIL"
            });
        }

        function showModal(isSuccess, feedback, policyNote) {
            els.modal.classList.remove('hidden');
            // Trigger animation
            requestAnimationFrame(() => {
                els.modal.classList.remove('opacity-0');
                els.modalContent.classList.remove('scale-95');
            });

            if (isSuccess) {
                els.modalTitle.innerText = "æˆ°è¡“åŸ·è¡ŒæˆåŠŸ";
                els.modalTitle.className = "text-3xl font-bold mb-4 font-tech uppercase text-green-500";
                els.modalBorder.className = "bg-gray-800/50 p-4 border-l-4 mb-6 border-green-500";
                els.modalStatus.innerText = "CODE: 200-OK // TARGET NEUTRALIZED";
                els.modalStatus.className = "text-sm font-tech text-green-500";
            } else {
                els.modalTitle.innerText = "æˆ°è¡“åŸ·è¡Œå¤±æ•—";
                els.modalTitle.className = "text-3xl font-bold mb-4 font-tech uppercase text-red-500";
                els.modalBorder.className = "bg-gray-800/50 p-4 border-l-4 mb-6 border-red-500";
                els.modalStatus.innerText = "CODE: 500-CRITICAL // DEFENSE BREACHED";
                els.modalStatus.className = "text-sm font-tech text-red-500";
            }

            els.modalFeedback.innerHTML = `${feedback}<br><br><span class="text-white font-bold">â˜… åœ‹é˜²çŸ¥è­˜é»ï¼š</span>${policyNote}`;

            // Check for Game Over condition to update button text
            if (gameState.defenseScore <= gameState.scoreThreshold) {
                els.modalNextBtn.innerText = "è§£æ”¾è»å·²ç¶“é€²å…¥å°åŒ—å¸‚ >>";
                els.modalNextBtn.className = "bg-red-600 text-white hover:bg-red-700 px-6 py-2 font-bold uppercase tracking-widest text-sm transition-colors";
            } else {
                els.modalNextBtn.innerText = "æŒ‡æ®å®˜ï¼Œä¸‹ä¸€æ³¢æ”»æ“Šä¾†äº† >>";
                els.modalNextBtn.className = "bg-white text-black hover:bg-gray-200 px-6 py-2 font-bold uppercase tracking-widest text-sm transition-colors";
            }
        }

        function nextLevel() {
            // Hide modal
            els.modal.classList.add('opacity-0');
            els.modalContent.classList.add('scale-95');
            
            setTimeout(() => {
                els.modal.classList.add('hidden');
                
                // Check death condition
                if(gameState.defenseScore <= gameState.scoreThreshold) {
                    triggerEnding(false);
                } else {
                    gameState.currentStage++;
                    loadScenario(gameState.currentStage);
                }
            }, 300);
        }

        function endGame() {
            // If they survived all stages
            triggerEnding(true);
        }

        function triggerEnding(isVictory) {
            screens.game.classList.add('hidden');
            screens.ending.classList.remove('hidden');

            const title = document.getElementById('ending-title');
            const desc = document.getElementById('ending-desc');
            const icon = document.getElementById('ending-icon');
            const stats = document.getElementById('ending-stats');

            if(isVictory) {
                screens.ending.className = "hud-border bg-gray-900/95 p-8 md:p-12 text-center border-green-500 shadow-[0_0_50px_rgba(0,255,157,0.2)]";
                icon.innerHTML = "ğŸ›¡ï¸";
                title.innerText = "ç³»çµ±å…¬å‘Šï¼šæˆåŠŸå®ˆè­·å®¶åœ’";
                title.className = "text-4xl md:text-5xl font-bold mb-6 text-green-400 tracking-tight";
                desc.innerHTML = `æŒ‡æ®å®˜ï¼Œæ‚¨å–„ç”¨äº†ã€Œå¼·åŒ–é˜²è¡›éŸŒæ€§åŠä¸å°ç¨±æˆ°åŠ›ã€é ç®—ã€‚<br><br>
                                  1. <strong>å¤šå±¤æ¬¡é˜²ç¦¦</strong> æˆåŠŸæŠµç¦¦äº†æ•µè» 5 æ³¢ç¾ä»£åŒ–æ”»å‹¢ã€‚<br>
                                  2. <strong>ç²¾æº–æ‰“æ“Š</strong> é˜»æ–·äº†æ•µè»çš„é›†çµã€‚<br>
                                  3. <strong>è‡ªä¸»åœ‹é˜²ç”¢æ¥­</strong> æ”¯æ’äº†æŒä¹…æˆ°ã€‚<br><br>
                                  è§£æ”¾è»ç¶“éè©•ä¼°ï¼Œå¯èƒ½æœƒæœ‰ä¸ä¸€æ¨£çš„æƒ³æ³•ã€‚`;
            } else {
                screens.ending.className = "hud-border bg-gray-900/95 p-8 md:p-12 text-center border-red-600 shadow-[0_0_50px_rgba(255,0,0,0.3)]";
                icon.innerHTML = "â˜ ï¸";
                title.innerText = "ç³»çµ±å…¬å‘Šï¼šå°ç£é˜²è¡›é«”ç³»å´©æ½°";
                title.className = "text-4xl md:text-5xl font-bold mb-6 text-red-600 tracking-tight";
                desc.innerHTML = `ç”±æ–¼ç¼ºä¹æ–°é ç®—æ”¯æŒçš„ã€Œä¸å°ç¨±æˆ°åŠ›ã€ï¼Œåœ¨é¢å°é€£çºŒ 5 æ³¢ç¾ä»£åŒ–æ”»å‹¢æ™‚ï¼Œå‚³çµ±å…µåŠ›æ¶ˆè€—æ®†ç›¡ã€‚<br>
                                  å½ˆè—¥è£œçµ¦ç·šä¸­æ–·ï¼ŒæŒ‡æ®ç³»çµ±ç™±ç˜“ã€‚<br><br>
                                  <strong>é€™æ˜¯è§£æ”¾è»æ¨‚è¦‹çš„æƒ…æ³ã€‚</strong>`;
            }

            // Stats
            stats.innerHTML = `
                <div class="text-gray-400 text-sm">æœ€çµ‚é˜²è¡›å€¼</div>
                <div class="text-right font-bold ${isVictory ? 'text-green-400' : 'text-red-500'} font-tech">${gameState.defenseScore}/10</div>
                <div class="text-gray-400 text-sm">å­˜æ´»æ³¢æ¬¡</div>
                <div class="text-right font-bold text-white font-tech">${gameState.currentStage}/${gameState.maxStages}</div>
            `;
        }

    </script>
</body>
</html>
