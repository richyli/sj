<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>彈性育嬰假試算模擬器</title>
    <!-- 引入 Tailwind CSS (用於快速排版) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons (圖示庫) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 簡單的淡入動畫 */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* 自訂滑桿樣式 */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #0d9488; /* teal-600 */
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800 font-sans p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-teal-600 to-emerald-600 p-6 md:p-8 text-white">
            <div class="flex items-center gap-3 mb-2">
                <i data-lucide="baby" class="w-8 h-8"></i>
                <h1 class="text-2xl md:text-3xl font-bold">彈性育嬰假試算模擬器</h1>
            </div>
            <p class="text-teal-100 opacity-90">
                測試，不一定正確
            </p>
        </div>

        <!-- Tab Switcher -->
        <div class="flex border-b border-slate-200">
            <button id="btn-tab-employee" onclick="switchTab('employee')" class="flex-1 py-4 text-center font-semibold transition-colors flex items-center justify-center gap-2 text-teal-600 border-b-4 border-teal-600 bg-teal-50">
                <i data-lucide="calculator" class="w-5 h-5"></i>
                我是勞工 (爸媽)
            </button>
            <button id="btn-tab-employer" onclick="switchTab('employer')" class="flex-1 py-4 text-center font-semibold transition-colors flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 hover:bg-slate-50">
                <i data-lucide="building-2" class="w-5 h-5"></i>
                我是雇主 (公司)
            </button>
        </div>

        <div class="p-6 md:p-8">
            
            <!-- EMPLOYEE VIEW -->
            <div id="view-employee" class="fade-in space-y-8 block">
                <!-- Controls -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-slate-700">月實際薪資 (新台幣)</label>
                        <div class="relative">
                            <i data-lucide="dollar-sign" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                            <input type="number" id="emp-salary-input" value="45800" class="w-full pl-10 pr-4 py-3 rounded-xl border border-slate-300 focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all">
                        </div>
                        <!-- Updated max to 200000 -->
                        <input type="range" id="emp-salary-range" min="27470" max="200000" step="100" value="45800" class="w-full">
                        <p class="text-xs text-slate-500 flex justify-between">
                            <span>註：以實際月薪推算</span>
                            <span id="insured-salary-hint" class="text-orange-600 font-medium hidden">⚠️ 投保薪資上限為 45,800</span>
                        </p>
                    </div>

                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-slate-700">預計請假天數 (上限30天)</label>
                        <div class="flex items-center gap-4">
                            <button onclick="updateDays(-1)" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-xl font-bold text-slate-600 transition-colors">-</button>
                            <div class="flex-1 text-center text-3xl font-bold text-teal-700 font-mono">
                                <span id="display-days">5</span> <span class="text-base font-normal text-slate-500">天</span>
                            </div>
                            <button onclick="updateDays(1)" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-xl font-bold text-slate-600 transition-colors">+</button>
                        </div>
                        <p class="text-xs text-slate-500 text-center">依規定，2年內有30天額度可彈性運用</p>
                    </div>
                </div>

                <!-- Financial Impact Card -->
                <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl p-6 border border-slate-200">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <i data-lucide="dollar-sign" class="w-5 h-5 text-teal-600"></i>
                        薪資試算結果
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-slate-600">
                            <span>公司扣除薪資 (以實際薪資計)</span>
                            <span id="res-lost-salary" class="font-mono text-red-500 font-medium">- $0</span>
                        </div>
                        <div class="flex justify-between items-center text-slate-600">
                            <span class="flex items-center gap-1">
                                勞保局津貼 (以投保薪資計) 
                                <span class="text-xs bg-teal-100 text-teal-800 px-1.5 py-0.5 rounded">8成</span>
                            </span>
                            <span id="res-allowance" class="font-mono text-teal-600 font-medium">+ $0</span>
                        </div>
                        
                        <!-- Added breakdown for clarity when cap is hit -->
                        <div id="cap-warning" class="hidden text-xs text-orange-600 bg-orange-50 p-2 rounded border border-orange-100">
                            您的月薪超過 45,800 元，津貼將以最高投保薪資 <strong>$45,800</strong> 計算，因此實際收入減少幅度會較大。
                        </div>

                        <div class="h-px bg-slate-300 my-2"></div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-slate-800">實際收入影響</span>
                            <span id="res-net-impact" class="font-mono font-bold text-xl text-teal-600">+ $0</span>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-blue-50 text-blue-800 text-sm rounded-lg flex gap-2 items-start">
                        <i data-lucide="info" class="w-4 h-4 mt-0.5 flex-shrink-0"></i>
                        <p>津貼為投保薪資的 60% (育嬰留職停薪津貼) + 20% (薪資補助)，合計 80%。</p>
                    </div>
                </div>

                <!-- Seniority Impact Card -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <i data-lucide="clock" class="w-5 h-5 text-orange-500"></i>
                        年資與特休影響
                    </h3>
                    
                    <div class="grid md:grid-cols-2 gap-6 items-center">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-2">原本預計年資滿週年/特休生效日</label>
                            <input type="date" id="join-date" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-orange-400 outline-none">
                        </div>
                        
                        <div class="flex flex-col items-center justify-center p-4 bg-orange-50 rounded-xl border border-orange-100">
                            <div class="text-sm text-orange-700 font-medium mb-1">調整後生效日</div>
                            <div class="flex items-center gap-2">
                                <span id="date-original" class="text-slate-400 line-through text-sm">--</span>
                                <i data-lucide="arrow-right" class="w-4 h-4 text-orange-400"></i>
                                <span id="date-delayed" class="text-xl font-bold text-orange-600">--</span>
                            </div>
                            <div class="text-xs text-orange-600/80 mt-2 text-center">
                                年資將延後 <span id="display-days-delay">5</span> 天計算<br>(除非雇主優於法令給予累計)
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EMPLOYER VIEW -->
            <div id="view-employer" class="fade-in space-y-8 hidden">
                <!-- Controls -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-slate-700">公司規模 (未滿30人小微企業?)</label>
                        <label class="flex items-center gap-3 p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="checkbox" id="is-small-company" checked class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500">
                            <span class="text-slate-700 font-medium">是的，我們是未滿30人的企業</span>
                        </label>
                        
                        <div class="pt-2">
                            <label class="block text-sm font-bold text-slate-700 mb-2">申請員工人數</label>
                            <div class="flex items-center gap-3">
                                <input type="number" id="emp-count" min="1" value="1" class="w-20 px-3 py-2 border border-slate-300 rounded-lg text-center">
                                <span class="text-slate-600">人</span>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-slate-700">員工平均月薪 / 申請天數</label>
                        <div class="flex gap-4">
                            <div class="flex-1">
                                <label class="text-xs text-slate-500 mb-1 block">月薪 (連動設定)</label>
                                <input type="number" id="boss-salary-input" value="45800" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                            </div>
                            <div class="flex-1">
                                <label class="text-xs text-slate-500 mb-1 block">每人天數 (連動設定)</label>
                                <input type="number" id="boss-days-input" value="5" max="30" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                            </div>
                        </div>
                        <div id="small-company-hint" class="mt-4 p-3 bg-yellow-50 text-yellow-800 rounded-lg text-sm border border-yellow-100">
                            <strong>獎勵政策：</strong> 政府發給雇主定額獎勵金 NT$1,000 /日。
                        </div>
                    </div>
                </div>

                <!-- Employer Result Card -->
                <div class="bg-gradient-to-br from-indigo-50 to-white rounded-2xl p-6 border border-indigo-100 shadow-sm">
                    <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2">
                        <i data-lucide="building-2" class="w-5 h-5 text-indigo-600"></i>
                        企業成本與效益評估
                    </h3>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center text-slate-600">
                                <span>暫時不需支付的薪資</span>
                                <span id="res-boss-saved" class="font-mono text-slate-800 font-medium">+ $0</span>
                            </div>
                            <div class="flex justify-between items-center text-slate-600">
                                <span>政府小微企業獎勵金</span>
                                <span id="res-boss-incentive" class="font-mono font-medium text-indigo-600">+ $0</span>
                            </div>
                            <div id="small-company-note" class="text-xs text-slate-400 text-right hidden">*(僅限未滿30人企業)</div>
                            <div class="h-px bg-indigo-200 my-2"></div>
                            <div class="flex justify-between items-center">
                                <span class="font-bold text-slate-800">企業現金流正向影響</span>
                                <span id="res-boss-total" class="font-mono font-bold text-xl text-indigo-600">+ $0</span>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-xl border border-slate-100 text-sm space-y-3">
                            <h4 class="font-bold text-slate-700">雇主注意事項：</h4>
                            <ul class="space-y-2 text-slate-600 list-disc list-inside">
                                <li><span class="font-semibold text-slate-800">年終/獎金發放：</span>若員工符合考績與條件，不能因發放當日請假而拒發。</li>
                                <li><span class="font-semibold text-slate-800">獎勵金申請：</span>勞保局將提供單一管道，填寫帳號後自動比對入帳。</li>
                                <li><span class="font-semibold text-slate-800">人力調度：</span>雖然節省了薪資成本，但需考量短期人力缺口。</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAQ SECTION -->
            <div class="mt-12 pt-8 border-t border-slate-200">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                    <i data-lucide="help-circle" class="w-6 h-6 text-teal-600"></i>
                    常見問題 (QA)
                </h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-slate-50 p-5 rounded-xl">
                        <h4 class="font-bold text-slate-800 mb-2">Q: 請彈性育嬰假會有薪水嗎？</h4>
                        <p class="text-slate-600 text-sm leading-relaxed">
                            雇主<span class="text-red-500 font-bold">不須</span>給付當日工資。但勞工可向勞保局申請津貼，合計約為平均月投保薪資的 <span class="text-teal-600 font-bold">80%</span>。
                            <br><span class="text-xs text-slate-500">*註：最高以投保薪資 45,800 元計算。</span>
                        </p>
                    </div>
                    <div class="bg-slate-50 p-5 rounded-xl">
                        <h4 class="font-bold text-slate-800 mb-2">Q: 年資會中斷嗎？特休怎麼算？</h4>
                        <p class="text-slate-600 text-sm leading-relaxed">
                            除非公司有優於法規的約定，否則請假期間<span class="text-red-500 font-bold">不計入</span>工作年資。因此，下一年度的特休假取得日期會往後順延。
                        </p>
                    </div>
                    <div class="bg-slate-50 p-5 rounded-xl">
                        <h4 class="font-bold text-slate-800 mb-2">Q: 雇主的獎勵金如何領取？</h4>
                        <p class="text-slate-600 text-sm leading-relaxed">
                            針對未滿30人的企業，勞保局將提供單一窗口，由企業填寫帳號，系統比對後直接入帳 (1日1000元)。
                        </p>
                    </div>
                    <div class="bg-slate-50 p-5 rounded-xl">
                        <h4 class="font-bold text-slate-800 mb-2">Q: 年終獎金會受影響嗎？</h4>
                        <p class="text-slate-600 text-sm leading-relaxed">
                            若員工已符合績效/年資條件，雇主<span class="text-red-500 font-bold">不能</span>因為發放當日員工在請假而拒發，但金額可能依在職比例調整。
                        </p>
                    </div>
                </div>

            </div>

            <!-- Footer -->
            <div class="bg-slate-100 p-4 text-center text-xs text-slate-500 border-t border-slate-200">
                本試算結果僅供參考，實際金額與權益請以勞保局及勞動部最新公告與核定為準。<br>
                資料來源：中央社報導 (彈性育嬰假政策)
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // 初始化 Lucide Icons
        lucide.createIcons();

        // 投保薪資上限 (重要常數)
        const MAX_INSURED_SALARY = 45800;

        // 狀態變數
        const state = {
            salary: 45800,
            days: 5,
            joinDate: new Date().toISOString().split('T')[0],
            isSmallCompany: true,
            empCount: 1
        };

        // DOM Elements
        const els = {
            empSalaryInput: document.getElementById('emp-salary-input'),
            empSalaryRange: document.getElementById('emp-salary-range'),
            insuredSalaryHint: document.getElementById('insured-salary-hint'),
            displayDays: document.getElementById('display-days'),
            displayDaysDelay: document.getElementById('display-days-delay'),
            joinDate: document.getElementById('join-date'),
            dateOriginal: document.getElementById('date-original'),
            dateDelayed: document.getElementById('date-delayed'),
            resLostSalary: document.getElementById('res-lost-salary'),
            resAllowance: document.getElementById('res-allowance'),
            resNetImpact: document.getElementById('res-net-impact'),
            capWarning: document.getElementById('cap-warning'),
            
            // Employer specific
            isSmallCompany: document.getElementById('is-small-company'),
            empCount: document.getElementById('emp-count'),
            bossSalaryInput: document.getElementById('boss-salary-input'),
            bossDaysInput: document.getElementById('boss-days-input'),
            resBossSaved: document.getElementById('res-boss-saved'),
            resBossIncentive: document.getElementById('res-boss-incentive'),
            resBossTotal: document.getElementById('res-boss-total'),
            smallCompanyHint: document.getElementById('small-company-hint'),
            smallCompanyNote: document.getElementById('small-company-note')
        };

        // 初始化日期
        els.joinDate.value = state.joinDate;

        // 格式化金錢
        const formatMoney = (num) => {
            return num.toLocaleString();
        };

        // 格式化日期
        const formatDate = (dateStr) => {
            const date = new Date(dateStr);
            return date.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric' });
        };

        // 主要計算與更新 UI 函數
        function updateUI() {
            // 同步 Inputs (保持勞雇雙方數據一致)
            els.empSalaryInput.value = state.salary;
            els.empSalaryRange.value = state.salary;
            els.bossSalaryInput.value = state.salary;
            els.displayDays.textContent = state.days;
            els.displayDaysDelay.textContent = state.days;
            els.bossDaysInput.value = state.days;

            // --- 勞工計算 ---
            const actualSalary = state.salary;
            
            // 1. 公司扣薪 (依據實際月薪)
            const dailySalary = Math.round(actualSalary / 30);
            const lostSalary = dailySalary * state.days;
            
            // 2. 政府津貼 (依據投保薪資，上限 45800)
            const insuredSalary = Math.min(actualSalary, MAX_INSURED_SALARY);
            // 津貼 = (投保薪資/30) * 0.8 * 天數
            const governmentAllowance = Math.round((insuredSalary / 30) * 0.8 * state.days);
            
            // 3. 實際影響
            const netIncomeImpact = governmentAllowance - lostSalary;

            // 更新 UI 顯示
            els.resLostSalary.textContent = `- $${formatMoney(lostSalary)}`;
            els.resAllowance.textContent = `+ $${formatMoney(governmentAllowance)}`;
            
            const impactSign = netIncomeImpact >= 0 ? '+' : '';
            els.resNetImpact.textContent = `${impactSign} $${formatMoney(netIncomeImpact)}`;
            
            // 根據是否虧損改變顏色
            if (netIncomeImpact >= 0) {
                els.resNetImpact.className = "font-mono font-bold text-xl text-teal-600";
            } else {
                els.resNetImpact.className = "font-mono font-bold text-xl text-red-500";
            }

            // 顯示/隱藏 投保薪資上限提示
            if (actualSalary > MAX_INSURED_SALARY) {
                els.insuredSalaryHint.classList.remove('hidden');
                els.capWarning.classList.remove('hidden');
            } else {
                els.insuredSalaryHint.classList.add('hidden');
                els.capWarning.classList.add('hidden');
            }

            // --- 年資日期計算 ---
            const originalDateObj = new Date(state.joinDate);
            const delayedDateObj = new Date(originalDateObj);
            delayedDateObj.setDate(originalDateObj.getDate() + parseInt(state.days));

            els.dateOriginal.textContent = formatDate(state.joinDate);
            els.dateDelayed.textContent = formatDate(delayedDateObj);

            // --- 雇主計算 ---
            const employerSavedSalary = dailySalary * state.days * state.empCount;
            const employerIncentive = state.isSmallCompany ? (1000 * state.days * state.empCount) : 0;
            const totalEmployerBenefit = employerSavedSalary + employerIncentive;

            els.resBossSaved.textContent = `+ $${formatMoney(employerSavedSalary)}`;
            els.resBossIncentive.textContent = `+ $${formatMoney(employerIncentive)}`;
            els.resBossIncentive.className = `font-mono font-medium ${state.isSmallCompany ? 'text-indigo-600' : 'text-slate-400'}`;
            els.resBossTotal.textContent = `+ $${formatMoney(totalEmployerBenefit)}`;

            // 小微企業 UI 切換
            if (state.isSmallCompany) {
                els.smallCompanyHint.style.display = 'block';
                els.smallCompanyNote.style.display = 'none';
            } else {
                els.smallCompanyHint.style.display = 'none';
                els.smallCompanyNote.style.display = 'block';
            }
        }

        // 事件監聽
        function setSalary(val) {
            state.salary = parseInt(val) || 0;
            updateUI();
        }

        function updateDays(delta) {
            let newDays = state.days + delta;
            if (newDays < 1) newDays = 1;
            if (newDays > 30) newDays = 30;
            state.days = newDays;
            updateUI();
        }

        function setDays(val) {
            let newDays = parseInt(val) || 1;
            if (newDays < 1) newDays = 1;
            if (newDays > 30) newDays = 30;
            state.days = newDays;
            updateUI();
        }

        // 綁定事件
        els.empSalaryInput.addEventListener('input', (e) => setSalary(e.target.value));
        els.empSalaryRange.addEventListener('input', (e) => setSalary(e.target.value));
        els.bossSalaryInput.addEventListener('input', (e) => setSalary(e.target.value));
        
        els.bossDaysInput.addEventListener('input', (e) => setDays(e.target.value));
        
        els.joinDate.addEventListener('change', (e) => {
            state.joinDate = e.target.value;
            updateUI();
        });

        els.isSmallCompany.addEventListener('change', (e) => {
            state.isSmallCompany = e.target.checked;
            updateUI();
        });

        els.empCount.addEventListener('input', (e) => {
            state.empCount = Math.max(1, parseInt(e.target.value) || 1);
            updateUI();
        });

        // Tab 切換邏輯
        function switchTab(tabName) {
            const empView = document.getElementById('view-employee');
            const bossView = document.getElementById('view-employer');
            const empBtn = document.getElementById('btn-tab-employee');
            const bossBtn = document.getElementById('btn-tab-employer');

            if (tabName === 'employee') {
                empView.classList.remove('hidden');
                bossView.classList.add('hidden');
                
                empBtn.className = "flex-1 py-4 text-center font-semibold transition-colors flex items-center justify-center gap-2 text-teal-600 border-b-4 border-teal-600 bg-teal-50";
                bossBtn.className = "flex-1 py-4 text-center font-semibold transition-colors flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 hover:bg-slate-50";
            } else {
                empView.classList.add('hidden');
                bossView.classList.remove('hidden');

                bossBtn.className = "flex-1 py-4 text-center font-semibold transition-colors flex items-center justify-center gap-2 text-indigo-600 border-b-4 border-indigo-600 bg-indigo-50";
                empBtn.className = "flex-1 py-4 text-center font-semibold transition-colors flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 hover:bg-slate-50";
            }
        }

        // 初次執行
        updateUI();

    </script>
</body>
</html>