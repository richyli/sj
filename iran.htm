<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰¹æ´¾å“¡ä»»å‹™ï¼šè§£ç¢¼å¾·é»‘è˜­</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Lalezar&family=Noto+Serif+TC:wght@400;700&display=swap');
        .font-amiri { font-family: 'Amiri', serif; }
        .font-lalezar { font-family: 'Lalezar', display; }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        
        /* Custom Scrollbar for compact view */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #d97706; 
        }

        /* Animations */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-950 text-amber-50 font-serif h-screen overflow-hidden flex items-center justify-center">

    <div id="root" class="w-full h-full max-w-lg max-h-[600px] relative"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons (SVG Components) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            Moon: (props) => <Icon {...props} path={<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>} />,
            BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />,
            Globe: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></>} />,
            MapIcon: (props) => <Icon {...props} path={<><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></>} />,
            Trophy: (props) => <Icon {...props} path={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></>} />,
            RefreshCcw: (props) => <Icon {...props} path={<><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></>} />,
            CheckCircle: (props) => <Icon {...props} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            XCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></>} />,
            ChevronRight: (props) => <Icon {...props} path={<path d="m9 18 6-6-6-6"/>} />,
            Star: (props) => <Icon {...props} path={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>} />,
        };

        // --- Data ---
        const RAW_QUIZ_QUESTIONS = [
          {
            type: 'map',
            question: "è«‹çœ‹ä¸Šæ–¹åœ°åœ–ï¼Œå“ªä¸€å€‹ä»£è™Ÿæ˜¯ã€Œä¼Šæœ—ã€çš„åœ°ç†ä½ç½®ï¼Ÿ",
            options: ["1", "2", "3", "4"],
            answer: 2,
            explanation: "C æ˜¯ä¼Šæœ—ã€‚å®ƒä½æ–¼ä¸­æ±å¿ƒè‡Ÿåœ°å¸¶ï¼ŒåŒ—è‡¨è£æµ·ï¼Œå—è‡¨æ³¢æ–¯ç£ã€‚A æ˜¯åœŸè€³å…¶ï¼ŒB æ˜¯ä¼Šæ‹‰å…‹ï¼ŒD æ˜¯æ²™çƒåœ°é˜¿æ‹‰ä¼¯ã€‚"
          },
          {
            question: "å°ç£çš„åŠ æ²¹ç«™æ²¹åƒ¹ï¼Œç‚ºä»€éº¼è·Ÿä¼Šæœ—å±€å‹¢æ¯æ¯ç›¸é—œï¼Ÿ",
            options: ["å°ç£çŸ³æ²¹ 100% å‘ä¼Šæœ—è³¼è²·", "70% é€²å£çŸ³æ²¹ç¶“éä¼Šæœ—æ§åˆ¶çš„è·å§†èŒ²æµ·å³½", "ä¼Šæœ—æ§åˆ¶äº†å°ç£çš„ä¸­æ²¹", "æ²’é—œä¿‚ï¼Œå°ç£æœ‰è‡ªç”¢çŸ³æ²¹"],
            answer: 1,
            explanation: "å°ç£è¶…é 7 æˆåŸæ²¹ä¾†è‡ªä¸­æ±ï¼Œé ˆé€šéä¼Šæœ—æŒæ§çš„è·å§†èŒ²æµ·å³½ã€‚è‹¥æµ·å³½è¢«å°é–ï¼Œå°ç£èƒ½æºå°‡æ‹‰è­¦å ±ã€‚"
          },
          {
            question: "å°ç£èˆ‡ä¼Šæœ—åœ¨åœ°ç†ä¸Šæœ‰ä¸€å€‹ä»¤äººææ‡¼çš„å…±åŒé»ï¼Œå°è‡´å…©åœ‹éƒ½å¸¸ç™¼ç”Ÿé‡å¤§å‚·äº¡ï¼Œé‚£æ˜¯ï¼Ÿ",
            options: ["éƒ½æœ‰åš´é‡çš„æ²™å¡µæš´", "éƒ½ä½æ–¼åœ°éœ‡å¸¶ä¸Šï¼Œåœ°éœ‡é »ç¹", "éƒ½æœ‰é »ç¹çš„é¢±é¢¨ä¾µè¥²", "éƒ½æœ‰æ´»ç«å±±éš¨æ™‚å™´ç™¼"],
            answer: 1,
            explanation: "å…©åœ‹éƒ½ä½æ–¼æ¿å¡Šäº¤ç•Œè™•ã€‚ä¼Šæœ—å·´å§†å¤åŸå¤§åœ°éœ‡æ›¾é€ æˆæ•¸è¬äººæ­»äº¡ï¼Œé€™é»å°ç£äººæ„ŸåŒèº«å—ã€‚"
          },
          {
            question: "éå¹´æ™‚å°ç£äººæ„›åƒçš„ã€Œé–‹å¿ƒæœã€ï¼Œä¸»è¦ç”¢åœ°ä¹‹ä¸€å°±æ˜¯ä¼Šæœ—ã€‚ç‚ºä»€éº¼åœ¨å°ç£å¾ˆå°‘çœ‹åˆ°åŒ…è£å¯«ã€Œä¼Šæœ—ç”¢ã€ï¼Ÿ",
            options: ["ä¼Šæœ—é–‹å¿ƒæœä¸å¥½åƒ", "åˆ¶è£å°è‡´è²¿æ˜“å›°é›£ï¼Œå¤šé€éç¬¬ä¸‰åœ°è½‰é‹", "ä¼Šæœ—é–‹å¿ƒæœæœ‰æ¯’", "å°ç£ç¦æ­¢é€²å£å …æœ"],
            answer: 1,
            explanation: "å› åœ‹éš›é‡‘èåˆ¶è£ï¼Œå°ç£å» å•†é›£ä»¥ç›´æ¥åŒ¯æ¬¾çµ¦ä¼Šæœ—ï¼Œå¸¸éœ€é€éæœæ‹œç­‰åœ°è½‰å£ï¼Œå°è‡´ç”¢åœ°æ¨™ç¤ºæ¨¡ç³Šã€‚"
          },
          {
            question: "åœ¨äºæ´²é«”å£‡ï¼Œä¼Šæœ—åœ¨å“ªå€‹é …ç›®æ˜¯å°ç£éšŠçš„å‚³çµ±å¼·æ•µï¼Œä¸”èº«æå„ªå‹¢å·¨å¤§ï¼Ÿ",
            options: ["æ£’çƒ", "æ¡Œçƒ", "ç±ƒçƒ", "ç¾½çƒ"],
            answer: 2,
            explanation: "ä¼Šæœ—ç±ƒçƒåœ¨äºæ´²å¯¦åŠ›å¼·å‹ï¼Œæ“æœ‰è¨±å¤šèº«æé«˜å¤§çš„çƒå“¡ï¼ˆå¦‚å“ˆé”è¿ªï¼‰ã€‚"
          },
          {
            question: "å¦‚æœæœ‰å°ç£å» å•†æƒ³è³£çç å¥¶èŒ¶æ©Ÿå™¨çµ¦ä¼Šæœ—ï¼Œç›®å‰é¢è‡¨æœ€å¤§çš„å¯¦å‹™å›°é›£æ˜¯ä»€éº¼ï¼Ÿ",
            options: ["ä¼Šæœ—äººè¨å­å–èŒ¶", "éŠ€è¡Œç„¡æ³•é€²è¡Œç¾å…ƒåŒ¯æ¬¾çµç®—ï¼ˆSWIFTåˆ¶è£ï¼‰", "ä¼Šæœ—ç¦æ­¢é€²å£æ©Ÿæ¢°", "å…©åœ‹æ™‚å·®å¤ªå¤§"],
            answer: 1,
            explanation: "æœ€å¤§éšœç¤™æ˜¯ã€Œé‡‘æµã€ã€‚å› ç¾åœ‹åˆ¶è£ï¼Œä¼Šæœ—è¢«è¸¢å‡º SWIFT ç³»çµ±ï¼Œå°è‡´è²¿æ˜“æ¥µå…¶å›°é›£ã€‚"
          },
          {
            question: "ä¼Šæœ—çš„é¦–éƒ½æ˜¯å“ªä¸€åº§åŸå¸‚ï¼Ÿ",
            options: ["ä¼Šæ–¯æ³•ç½•", "è¨­æ‹‰å­", "å¾·é»‘è˜­", "é¦¬ä»€å“ˆå¾·"],
            answer: 2,
            explanation: "å¾·é»‘è˜­æ˜¯ä¼Šæœ—é¦–éƒ½ï¼Œä½æ–¼åŒ—éƒ¨å±±è…³ä¸‹ï¼Œäººå£è¶…é 800 è¬ã€‚"
          },
          {
            question: "ä¼Šæœ—çš„äººå£å¤§ç´„æ˜¯å¤šå°‘ï¼Ÿï¼ˆä»¥å°ç£ç´„ 2300 è¬äººç‚ºåŸºæº–ï¼‰",
            options: ["ç´„ 2300 è¬", "ç´„ 4500 è¬", "ç´„ 9000 è¬", "ç´„ 2 å„„"],
            answer: 2,
            explanation: "ä¼Šæœ—äººå£æ¥è¿‘ 9,000 è¬ï¼Œæ˜¯ä¸­æ±äººå£æœ€å¤šçš„åœ‹å®¶ä¹‹ä¸€ã€‚"
          },
          {
            question: "é—œæ–¼ä¼Šæœ—çš„ç¶“æ¿Ÿå¯¦åŠ›ï¼ˆGDPï¼‰ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…è¼ƒæº–ç¢ºï¼Ÿ",
            options: ["æ²’å·¥æ¥­ï¼Œåªé è³£çŸ³æ²¹", "é›–å—åˆ¶è£ï¼Œä»æœ‰ä¸­æ±å‰æ®µç­çš„å·¥æ¥­å¯¦åŠ›", "ä¸­æ±æœ€è²§çª®ï¼Œä¾è³´å¤–æ´", "90% äººå£å¾äº‹è¾²æ¥­"],
            answer: 1,
            explanation: "é›–å—åˆ¶è£å°è‡´é€šè†¨ï¼Œä½†ä¼Šæœ—æ“æœ‰æ±½è»Šã€é‹¼éµç­‰å®Œæ•´å·¥æ¥­é«”ç³»ï¼ŒGDP åœ¨ä¸­æ±ä»å±…å‰åˆ—ã€‚"
          },
          {
            question: "è¨±å¤šäººä»¥ç‚ºä¼Šæœ—å…¨æ˜¯æ²™æ¼ ï¼Œä½†åœ¨é¦–éƒ½å¾·é»‘è˜­çš„å†¬å¤©å…¶å¯¦æœƒ...",
            options: ["ç†±åˆ° 40 åº¦", "ä¸‹é›ªï¼Œé™„è¿‘æœ‰æ»‘é›ªå ´", "æ¯å¤©ä¸‹æš´é›¨", "ä¹¾æ—±ä½†æ°£æº«ç¶­æŒ 25 åº¦"],
            answer: 1,
            explanation: "ä¼Šæœ—åœ°å½¢å¤šå±±å››å­£åˆ†æ˜ã€‚å¾·é»‘è˜­å†¬å­£å¸¸ä¸‹é›ªï¼ŒDizin æ˜¯è‘—åæ»‘é›ªå‹åœ°ã€‚"
          },
          {
            question: "å»ä¼Šæœ—æ—…éŠæ›åŒ¯æ™‚ï¼Œæœ€ä»¤äººå›°æƒ‘çš„ã€Œæ•¸å­¸é¡Œã€æ˜¯ä»€éº¼ï¼Ÿ",
            options: ["åªç”¨ç¡¬å¹£", "å®˜æ–¹ç”¨é‡Œäºçˆ¾(Rial)ï¼Œæ°‘é–“å ±åƒ¹ç”¨åœŸæ›¼(Toman)", "åŒ¯ç‡æ¯å°æ™‚è·Œ 10%", "åªèƒ½ç”¨é»ƒé‡‘äº¤æ˜“"],
            answer: 1,
            explanation: "1 åœŸæ›¼ = 10 é‡Œäºçˆ¾ã€‚æ°‘é–“ç¿’æ…£å ±åœŸæ›¼ï¼ˆå°‘ä¸€å€‹é›¶ï¼‰ï¼ŒéŠå®¢å¸¸å› æ­¤å¤šä»˜ 10 å€çš„éŒ¢ã€‚"
          },
          {
            question: "ä¼Šæœ—çš„å®˜æ–¹èªè¨€æ˜¯ä»€éº¼ï¼Ÿ",
            options: ["é˜¿æ‹‰ä¼¯èª", "æ³¢æ–¯èª (Farsi)", "åœŸè€³å…¶èª", "åº«å¾·èª"],
            answer: 1,
            explanation: "ä¼Šæœ—äººä¸æ˜¯é˜¿æ‹‰ä¼¯äººï¼ä»–å€‘èªªæ³¢æ–¯èªï¼Œæ“æœ‰ç¨ç«‹çš„å¤è€æ–‡æ˜ã€‚"
          },
          {
            question: "1979 å¹´ç™¼ç”Ÿä»€éº¼é‡å¤§äº‹ä»¶ï¼Œæ”¹è®Šäº†åœ‹å®¶é«”åˆ¶ï¼Ÿ",
            options: ["ä¼Šæ–¯è˜­é©å‘½", "æ³¢æ–¯ç£æˆ°çˆ­", "ç™½è‰²é©å‘½", "ä¸€æˆ°"],
            answer: 0,
            explanation: "1979 å¹´ä¼Šæ–¯è˜­é©å‘½æ¨ç¿»äº†è¦ªç¾ç‹æœï¼Œå»ºç«‹äº†ä¼Šæ–¯è˜­å…±å’Œåœ‹ã€‚"
          },
          {
            question: "ä¼Šæœ—çš„æœ€é«˜æ¬ŠåŠ›é ˜è¢–æ˜¯èª°ï¼Ÿ",
            options: ["ç¸½çµ±", "åœ‹æœƒè­°é•·", "æœ€é«˜é ˜è¢– (Supreme Leader)", "åœ‹é˜²éƒ¨é•·"],
            answer: 2,
            explanation: "ä¼Šæœ—æœ‰ç¸½çµ±ï¼Œä½†è»äº‹ã€å®—æ•™èˆ‡å¸æ³•å¤§æ¬ŠæŒæ¡åœ¨ã€Œæœ€é«˜é ˜è¢–ã€å“ˆç±³å°¼æ‰‹ä¸­ã€‚"
          },
          {
            question: "ä¼Šæœ—æ˜¯ä¸–ç•Œä¸Šå“ªå€‹æ•™æ´¾çš„æœ€å¤§åœ‹å®¶ï¼Ÿ",
            options: ["ä¼Šæ–¯è˜­æ•™éœå°¼æ´¾", "ä¼Šæ–¯è˜­æ•™ä»€è‘‰æ´¾", "æ‹œç«æ•™", "åŸºç£æ•™"],
            answer: 1,
            explanation: "ä¼Šæœ—æ˜¯å…¨çƒæœ€å¤§çš„ä»€è‘‰æ´¾ç©†æ–¯æ—åœ‹å®¶ï¼Œé€™ä½¿å®ƒåœ¨ä¸­æ±ç¨æ¨¹ä¸€æ ¼ã€‚"
          },
          {
            question: "ä¼Šæœ—æ§åˆ¶è‘—å…¨çƒæœ€é‡è¦çš„çŸ³æ²¹é‹è¼¸å’½å–‰ï¼Œå«ä»€éº¼åå­—ï¼Ÿ",
            options: ["è˜‡ä¼Šå£«é‹æ²³", "éº»å…­ç”²æµ·å³½", "è·å§†èŒ²æµ·å³½", "ç›´å¸ƒç¾…é™€æµ·å³½"],
            answer: 2,
            explanation: "å…¨çƒç´„ 20% çš„çŸ³æ²¹é‹è¼¸é€šéè·å§†èŒ²æµ·å³½ï¼Œä¸€èˆ‰ä¸€å‹•å½±éŸ¿å…¨çƒã€‚"
          },
          {
            question: "å—åˆ°åœ‹éš›åˆ¶è£å½±éŸ¿ï¼Œä¼Šæœ—é¢è‡¨åš´é‡çš„ä»€éº¼ç¶“æ¿Ÿå•é¡Œï¼Ÿ",
            options: ["å‹å‹•åŠ›çŸ­ç¼º", "è¶…ç´šé€šè²¨è†¨è„¹", "äººå£è€åŒ–", "ç”¢èƒ½éå‰©"],
            answer: 1,
            explanation: "è²¨å¹£é‡Œäºçˆ¾å¤§å¹…è²¶å€¼ï¼Œç‰©åƒ¹é£†æ¼²åš´é‡å½±éŸ¿æ°‘ç”Ÿã€‚"
          },
          {
            question: "ä¼Šæœ—æ“æœ‰ä¸€ç¨®ä¸–ç•Œæœ€æ˜‚è²´çš„é¦™æ–™ï¼Œç”¢é‡ä½”å…¨çƒ 90%ï¼Œå®ƒæ˜¯ï¼Ÿ",
            options: ["è‚‰æ¡‚", "ç•ªç´…èŠ± (Saffron)", "é¦™è‰", "é»‘èƒ¡æ¤’"],
            answer: 1,
            explanation: "ç•ªç´…èŠ±è¢«ç¨±ç‚ºã€Œç´…è‰²é»ƒé‡‘ã€ï¼Œæ˜¯ä¼Šæœ—æœ€é‡è¦çš„å‡ºå£è¾²ç”¢å“ã€‚"
          },
          {
            question: "é—œæ–¼ä¼Šæœ—çš„äººå£çµæ§‹ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ",
            options: ["æ¥µåº¦é«˜é½¡åŒ–", "å¹´è¼•ä¸”å—æ•™è‚²ç¨‹åº¦é«˜", "å¤šæ•¸ç‚ºæ–‡ç›²", "ä»¥è¾²æ‘äººå£ç‚ºä¸»"],
            answer: 1,
            explanation: "ä¼Šæœ— 60% äººå£åœ¨ 30 æ­²ä»¥ä¸‹ï¼Œä¸”å¤§å­¸ç”Ÿæ¯”ä¾‹æ¥µé«˜ï¼ˆå¥³æ€§ä½” 60%ï¼‰ã€‚"
          },
          {
            question: "ä¼Šæœ—äººæ…¶ç¥çš„æ–°å¹´å«åšä»€éº¼ï¼Ÿ",
            options: ["é–‹é½‹ç¯€", "ç´å¾è‚‰å­œç¯€ (Nowruz)", "è–èª•ç¯€", "æ„Ÿæ©ç¯€"],
            answer: 1,
            explanation: "Nowruz æ˜¯æ³¢æ–¯æ­·æ–°å¹´ï¼ˆæ˜¥åˆ†ï¼‰ï¼Œæºè‡ªå¤è€çš„ç‘£ç¾…äºæ–¯å¾·æ•™å‚³çµ±ã€‚"
          },
          {
            question: "åœ¨ä¼Šæœ—ï¼Œç”·æ€§é€šå¸¸è¢«ç¦æ­¢åœ¨å…¬å…±å ´åˆç©¿ä»€éº¼ï¼Ÿ",
            options: ["çŸ­è¤²", "ç‰›ä»”è¤²", "Tæ¤", "è¥¯è¡«"],
            answer: 0,
            explanation: "æ ¹æ“šæœå„€è¦å®šï¼Œç”·æ€§åœ¨å…¬å…±å ´åˆä¸å¯ç©¿è‘—çŸ­è¤²ã€‚"
          }
        ];

        // --- Helper Components ---
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        const PersianBorder = ({ children, className = "" }) => (
            <div className={`relative p-1 bg-gradient-to-br from-amber-500 via-amber-200 to-amber-600 rounded-lg shadow-2xl ${className}`}>
                <div className="bg-slate-900/95 backdrop-blur-sm rounded-md p-4 relative overflow-hidden h-full border border-amber-500/30">
                    <div className="absolute top-0 left-0 w-8 h-8 pointer-events-none">
                        <div className="absolute top-1 left-1 w-full h-full border-t-2 border-l-2 border-amber-400 rounded-tl-xl opacity-60"></div>
                    </div>
                    <div className="absolute top-0 right-0 w-8 h-8 pointer-events-none">
                        <div className="absolute top-1 right-1 w-full h-full border-t-2 border-r-2 border-amber-400 rounded-tr-xl opacity-60"></div>
                    </div>
                    <div className="absolute bottom-0 left-0 w-8 h-8 pointer-events-none">
                        <div className="absolute bottom-1 left-1 w-full h-full border-b-2 border-l-2 border-amber-400 rounded-bl-xl opacity-60"></div>
                    </div>
                    <div className="absolute bottom-0 right-0 w-8 h-8 pointer-events-none">
                        <div className="absolute bottom-1 right-1 w-full h-full border-b-2 border-r-2 border-amber-400 rounded-br-xl opacity-60"></div>
                    </div>
                    
                    <div className="absolute top-2 left-1/2 -translate-x-1/2 opacity-20 pointer-events-none text-amber-500 font-amiri text-lg">
                    Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù
                    </div>
                    
                    {children}
                </div>
            </div>
        );

        const DecorativeDivider = () => (
            <div className="flex items-center justify-center my-3 gap-2 opacity-80">
                <div className="h-[1px] w-8 bg-gradient-to-r from-transparent to-amber-400"></div>
                <div className="text-amber-400 text-[10px] font-amiri tracking-widest transform rotate-45">âœ¦</div>
                <Icons.Star size={10} className="text-amber-300 fill-amber-300" />
                <div className="text-amber-400 text-[10px] font-amiri tracking-widest transform rotate-45">âœ¦</div>
                <div className="h-[1px] w-8 bg-gradient-to-l from-transparent to-amber-400"></div>
            </div>
        );

        const ProgressBar = ({ current, total }) => (
            <div className="w-full mb-4">
                <div className="flex justify-between text-[10px] text-amber-200/80 mb-1 font-serif tracking-wider uppercase">
                    <span>Progress</span>
                    <span className="font-amiri text-base leading-none">{current} / {total}</span>
                </div>
                <div className="h-2 bg-slate-900 rounded-full border border-amber-900/50 overflow-hidden relative">
                    <div 
                        className="h-full bg-gradient-to-r from-teal-700 via-teal-500 to-teal-400 rounded-full transition-all duration-700 ease-out relative"
                        style={{ width: `${(current / total) * 100}%` }}
                    >
                        <div className="absolute inset-0 bg-white/20 w-full h-full animate-pulse"></div>
                    </div>
                </div>
            </div>
        );

        const FeedbackCard = ({ result, onNext, isLast }) => (
            <div className="animate-fade-in space-y-3 bg-slate-800/80 p-4 rounded-lg border border-amber-500/30 shadow-inner relative overflow-hidden">
                <div className="absolute -right-2 -bottom-2 text-6xl opacity-5 text-amber-500 font-amiri pointer-events-none select-none">
                    {result.isCorrect ? 'ØµØ­ÛŒØ­' : 'ØºÙ„Ø·'}
                </div>

                <div className="flex items-center gap-2 border-b border-amber-500/20 pb-2">
                    {result.isCorrect ? (
                        <Icons.CheckCircle className="text-teal-400 shrink-0" size={24} />
                    ) : (
                        <Icons.XCircle className="text-rose-500 shrink-0" size={24} />
                    )}
                    <h3 className={`font-serif font-bold text-lg ${result.isCorrect ? 'text-teal-400' : 'text-rose-400'}`}>
                        {result.title}
                    </h3>
                </div>
                <p className="text-amber-50/90 leading-relaxed font-serif text-sm">
                    {result.text}
                </p>
                <button 
                    onClick={onNext}
                    className="w-full py-2.5 bg-gradient-to-r from-amber-700 to-amber-600 hover:from-amber-600 hover:to-amber-500 text-white font-bold rounded-md mt-4 flex items-center justify-center gap-2 shadow-lg transition-all transform active:scale-[0.98] border border-amber-500/50 text-sm"
                >
                    {isLast ? "æŸ¥çœ‹æœ€çµ‚æˆç¸¾" : "ä¸‹ä¸€é¡Œ"} 
                    <span className="font-amiri text-base pt-1">{isLast ? 'Ù¾Ø§ÛŒØ§Ù†' : 'Ø¨Ø¹Ø¯ÛŒ'}</span>
                    {isLast ? <Icons.Trophy size={16}/> : <Icons.ChevronRight size={16}/>}
                </button>
            </div>
        );

        const PersianBackground = () => (
            <div className="absolute inset-0 z-0 pointer-events-none overflow-hidden bg-slate-950 rounded-lg">
                <div className="absolute inset-0 opacity-10" 
                     style={{ 
                         backgroundImage: `linear-gradient(30deg, #fbbf24 12%, transparent 12.5%, transparent 87%, #fbbf24 87.5%, #fbbf24), linear-gradient(150deg, #fbbf24 12%, transparent 12.5%, transparent 87%, #fbbf24 87.5%, #fbbf24), linear-gradient(30deg, #fbbf24 12%, transparent 12.5%, transparent 87%, #fbbf24 87.5%, #fbbf24), linear-gradient(150deg, #fbbf24 12%, transparent 12.5%, transparent 87%, #fbbf24 87.5%, #fbbf24), linear-gradient(60deg, #fbbf2477 25%, transparent 25.5%, transparent 75%, #fbbf2477 75%, #fbbf2477), linear-gradient(60deg, #fbbf2477 25%, transparent 25.5%, transparent 75%, #fbbf2477 75%, #fbbf2477)`,
                         backgroundSize: '40px 70px',
                         backgroundPosition: '0 0, 0 0, 20px 35px, 20px 35px, 0 0, 20px 35px'
                     }}>
                </div>
                <div className="absolute top-[5%] left-[5%] text-6xl font-amiri text-teal-900/20 rotate-12 select-none">Ø§ÛŒØ±Ø§Ù†</div>
                <div className="absolute bottom-[10%] right-[5%] text-5xl font-amiri text-amber-900/20 -rotate-12 select-none">ÙØ±Ù‡Ù†Ú¯</div>
                <div className="absolute inset-0 bg-gradient-to-b from-slate-950/80 via-transparent to-slate-950/80"></div>
            </div>
        );

        // --- Main App ---
        function App() {
            const [phase, setPhase] = useState('intro');
            const [currentStep, setCurrentStep] = useState(0);
            const [quizScore, setQuizScore] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [activeQuestions, setActiveQuestions] = useState([]);
            const bottomRef = useRef(null);

            useEffect(() => {
                if (bottomRef.current) bottomRef.current.scrollIntoView({ behavior: 'smooth' });
            }, [feedback, currentStep, phase]);

            const startQuiz = () => {
                const shuffled = shuffleArray(RAW_QUIZ_QUESTIONS);
                setActiveQuestions(shuffled);
                setPhase('quiz');
                setCurrentStep(0);
                setQuizScore(0);
                setFeedback(null);
            };

            const handleQuizAnswer = (optionIndex) => {
                const currentQ = activeQuestions[currentStep];
                const isCorrect = optionIndex === currentQ.answer;
                if (isCorrect) setQuizScore(prev => prev + 1);
                setFeedback({
                    isCorrect,
                    title: isCorrect ? "ç­”å°äº†ï¼" : "å¯æƒœäº†...",
                    text: currentQ.explanation
                });
            };

            const nextQuiz = () => {
                setFeedback(null);
                if (currentStep < activeQuestions.length - 1) {
                    setCurrentStep(prev => prev + 1);
                } else {
                    setPhase('ending');
                }
            };

            // Container style to ensure fixed height scrolling
            const scrollContainerClass = "w-full h-full overflow-y-auto px-4 py-4 relative z-10 scroll-smooth";

            return (
                <div className="w-full h-full relative bg-slate-950 rounded-lg shadow-2xl overflow-hidden border border-slate-800">
                    <PersianBackground />
                    
                    {phase === 'intro' && (
                        <div className={`${scrollContainerClass} flex flex-col items-center justify-center text-center`}>
                            <PersianBorder className="w-full animate-fade-in-up">
                                <div className="flex justify-center mb-4 relative">
                                    <div className="w-16 h-16 bg-gradient-to-br from-teal-700 to-blue-900 rounded-full flex items-center justify-center shadow-lg border-2 border-amber-500/40 relative z-10">
                                        <Icons.Moon size={32} className="text-amber-300 fill-amber-300" />
                                    </div>
                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-24 bg-amber-500/20 blur-xl rounded-full"></div>
                                </div>
                                
                                <h1 className="text-3xl font-bold mb-1 text-transparent bg-clip-text bg-gradient-to-r from-amber-200 via-yellow-400 to-amber-200 tracking-wider drop-shadow-sm font-serif">
                                    è§£ç¢¼å¾·é»‘è˜­
                                </h1>
                                <p className="text-lg text-teal-400 font-amiri mb-1 opacity-90">Ù…Ø£Ù…ÙˆØ±ÛŒØª ØªÙ‡Ø±Ø§Ù†</p>
                                <p className="text-[10px] text-amber-200/60 uppercase tracking-[0.3em] mb-4">Mission Tehran</p>
                                
                                <DecorativeDivider />
                                
                                <p className="text-amber-100/90 mb-6 leading-relaxed text-sm">
                                    é€™æ˜¯ä¸€å ´ç©¿è¶Šæ³¢æ–¯å¤åœ‹çš„çŸ¥è­˜ä¹‹æ—…ã€‚<br/>
                                    å¾<b>æ²¹åƒ¹</b>åˆ°<b>é–‹å¿ƒæœ</b>ï¼Œå¾<b>åˆ¶è£</b>åˆ°<b>è©©æ­Œ</b>ã€‚<br/>
                                    <span className="text-teal-300 text-sm block mt-2 font-amiri text-lg">Ø¢ÛŒØ§ Ø¢Ù…Ø§Ø¯Ù‡ Ø³ÙØ± Ù‡Ø³ØªÛŒØ¯ØŸ</span>
                                </p>
                                
                                <button 
                                    onClick={startQuiz}
                                    className="w-full py-3 bg-gradient-to-r from-teal-800 to-teal-700 hover:from-teal-700 hover:to-teal-600 text-white font-bold rounded shadow-lg border-b-4 border-teal-950 active:border-b-0 active:translate-y-1 transition-all flex items-center justify-center gap-2 text-base group"
                                >
                                    <Icons.BookOpen size={20} className="text-amber-300 group-hover:scale-110 transition-transform"/> 
                                    é–‹å§‹æ—…ç¨‹ <span className="font-amiri pt-1 text-lg">Ø´Ø±ÙˆØ¹</span>
                                </button>
                            </PersianBorder>
                        </div>
                    )}

                    {phase === 'quiz' && activeQuestions.length > 0 && (
                        <div className={`${scrollContainerClass} flex flex-col items-center`}>
                            <div className="w-full pb-8">
                                <div className="flex items-center justify-center gap-2 mb-4 text-amber-500">
                                    <div className="h-[1px] w-6 bg-amber-500/50"></div>
                                    <span className="font-amiri text-xl pt-1">Ø¢Ø²Ù…ÙˆÙ† Ø¯Ø§Ù†Ø´</span>
                                    <div className="h-[1px] w-6 bg-amber-500/50"></div>
                                </div>

                                <ProgressBar current={currentStep + 1} total={activeQuestions.length} />
                                
                                <PersianBorder>
                                    {activeQuestions[currentStep].type === 'map' && (
                                        <div className="inline-flex items-center gap-1 bg-teal-900/60 text-teal-200 text-[10px] px-2 py-0.5 rounded mb-3 border border-teal-500/30 font-bold">
                                            <Icons.MapIcon size={10} /> åœ°åœ–è¾¨è­˜ <span className="font-amiri text-sm mx-1">Ù†Ù‚Ø´Ù‡</span>
                                        </div>
                                    )}

                                    <h3 className="text-lg font-bold mb-4 leading-relaxed text-amber-50 drop-shadow-md font-serif">
                                        {activeQuestions[currentStep].question}
                                    </h3>
                                    
                                    {activeQuestions[currentStep].type === 'map' && (
                                        <div className="w-full aspect-video bg-slate-800 rounded border-2 border-amber-600/30 mb-4 flex items-center justify-center overflow-hidden shadow-2xl relative group">
                                            <div className="absolute inset-0 border-4 border-amber-500/10 pointer-events-none z-10"></div>
                                            <img 
                                                src="map.png" 
                                                alt="Middle East Map" 
                                                className="w-full h-full object-contain opacity-90 transition-opacity"
                                                onError={(e) => {
                                                    e.target.onerror = null; 
                                                    e.target.parentNode.innerHTML = '<div class="text-amber-500/50 text-xs p-4 flex flex-col items-center"><span class="text-xl mb-1">ğŸ—ºï¸</span>åœ°åœ–è¼‰å…¥ä¸­...</div>'
                                                }}
                                            />
                                        </div>
                                    )}

                                    {!feedback && (
                                        <div className="space-y-2">
                                            {activeQuestions[currentStep].options.map((opt, idx) => (
                                                <button
                                                    key={idx}
                                                    onClick={() => handleQuizAnswer(idx)}
                                                    className="w-full text-left p-3 bg-slate-800/80 hover:bg-slate-700/90 border border-slate-600 hover:border-amber-400/50 rounded transition-all active:scale-[0.99] group relative overflow-hidden flex items-baseline"
                                                >
                                                    <div className="absolute left-0 top-0 bottom-0 w-1 bg-amber-500/0 group-hover:bg-amber-500 transition-colors"></div>
                                                    <span className="shrink-0 inline-block w-6 h-6 bg-slate-700 group-hover:bg-amber-500 group-hover:text-slate-900 rounded-full text-center text-xs leading-6 mr-3 text-amber-500/80 font-bold transition-colors font-serif">
                                                        {String.fromCharCode(65+idx)}
                                                    </span>
                                                    <span className="text-slate-200 group-hover:text-white text-sm">{opt}</span>
                                                </button>
                                            ))}
                                        </div>
                                    )}

                                    {feedback && (
                                        <FeedbackCard 
                                            result={feedback} 
                                            onNext={nextQuiz} 
                                            isLast={currentStep === activeQuestions.length - 1} 
                                        />
                                    )}
                                </PersianBorder>
                                <div ref={bottomRef} />
                            </div>
                        </div>
                    )}

                    {phase === 'ending' && (
                        <div className={`${scrollContainerClass} flex flex-col items-center justify-center text-center`}>
                            <PersianBorder className="w-full">
                                <div className="mb-4 relative inline-block">
                                    <div className="absolute inset-0 bg-amber-400 blur-xl opacity-20 rounded-full"></div>
                                    <Icons.Trophy size={48} className="relative z-10 text-amber-400 drop-shadow-lg mx-auto" />
                                </div>
                                
                                <h2 className="text-2xl font-bold mb-0.5 text-white font-serif">æ—…ç¨‹çµæŸ</h2>
                                <p className="text-amber-500 font-amiri text-xl mb-4">Ù¾Ø§ÛŒØ§Ù† Ø³ÙØ±</p>
                                
                                <div className="my-4 py-3 border-y border-amber-500/20 bg-slate-800/30 relative">
                                    <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 text-amber-500 bg-slate-900 px-2 font-amiri text-base">Ø§Ù…ØªÛŒØ§Ø²</div>
                                    <div className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-amber-300 to-amber-600 font-serif mt-1">
                                        {quizScore} <span className="text-lg text-slate-500">/ {activeQuestions.length}</span>
                                    </div>
                                </div>
                                
                                <div className="mb-6">
                                    <p className="text-[10px] text-slate-400 uppercase tracking-widest mb-1">ç²å¾—ç¨±è™Ÿ</p>
                                    <h3 className="text-xl font-bold text-teal-400 mb-0.5">
                                        {quizScore === activeQuestions.length ? "å¾·é»‘è˜­é¦–å¸­å°ˆå®¶" : 
                                         quizScore >= activeQuestions.length * 0.75 ? "è³‡æ·±åœ‹éš›è§€å¯Ÿå®¶" :
                                         quizScore >= activeQuestions.length * 0.5 ? "å…·æ½›åŠ›çš„ç‰¹æ´¾å“¡" : "éœ€è£œèª²çš„è§€å…‰å®¢"}
                                    </h3>
                                    <p className="text-lg text-teal-600 font-amiri opacity-80">
                                        {quizScore === activeQuestions.length ? "Ø§Ø³ØªØ§Ø¯ ØªÙ‡Ø±Ø§Ù†" : 
                                         quizScore >= activeQuestions.length * 0.75 ? "Ù†Ø§Ø¸Ø± Ø¨ÛŒÙ† Ø§Ù„Ù…Ù„Ù„ÛŒ" :
                                         quizScore >= activeQuestions.length * 0.5 ? "Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±" : "Ú¯Ø±Ø¯Ø´Ú¯Ø±"}
                                    </p>
                                </div>

                                <p className="text-amber-100/70 leading-relaxed mb-6 text-justify bg-slate-900/50 p-3 rounded border border-slate-700/50 text-xs">
                                     {quizScore === activeQuestions.length ? "ä¸å¯æ€è­°ï¼å…¨å°ï¼ä½ å°ä¼Šæœ—çš„äº†è§£æ¯”è¨±å¤šå¤–äº¤å®˜é‚„è¦æ·±ã€‚ä½ å®Œå…¨çœ‹æ‡‚äº†å°ç£èˆ‡ä¸­æ±ä¹‹é–“åƒçµ²è¬ç¸·çš„é—œä¿‚ã€‚" : 
                                      quizScore >= activeQuestions.length * 0.75 ? "éå¸¸å²å®³ï¼ä½ å…·å‚™æ¥µä½³çš„åœ‹éš›è¦–é‡ï¼Œå°æ–¼åœ°ç·£æ”¿æ²»èˆ‡æ–‡åŒ–éƒ½æœ‰ç›¸ç•¶æ·±åº¦çš„èªè­˜ã€‚" :
                                      quizScore >= activeQuestions.length * 0.5 ? "ä½ å°ä¼Šæœ—æœ‰åŸºç¤çš„èªè­˜ï¼Œä½†é‚„æœ‰ä¸€äº›åˆ»æ¿å°è±¡æˆ–èª¤è§£ã€‚å†å¤šé—œæ³¨ä¸€é»åœ‹éš›æ–°èï¼Œä½ æœƒçœ‹è¦‹æ›´å¯¬å»£çš„ä¸–ç•Œã€‚" : 
                                      "ä¼Šæœ—å°ä½ ä¾†èªªå¯èƒ½é‚„å¾ˆé™Œç”Ÿã€‚åˆ¥æ“”å¿ƒï¼Œé€™æ¬¡æŒ‘æˆ°å°±æ˜¯æ‰“ç ´åè¦‹çš„ç¬¬ä¸€æ­¥ï¼"}
                                </p>

                                <button 
                                    onClick={startQuiz}
                                    className="w-full py-3 bg-slate-800 hover:bg-slate-700 text-amber-400 font-bold rounded border border-amber-500/30 hover:border-amber-500/60 flex items-center justify-center gap-2 transition-all group text-sm"
                                >
                                    <Icons.RefreshCcw size={16} className="group-hover:rotate-180 transition-transform duration-500"/> 
                                    å†æ¬¡æŒ‘æˆ° <span className="font-amiri text-base pt-1">Ø¯ÙˆØ¨Ø§Ø±Ù‡</span>
                                </button>
                            </PersianBorder>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
