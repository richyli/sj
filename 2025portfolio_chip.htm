<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 台股籌碼模擬器 (Flat Layout)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #D4AF37; 
            border-radius: 2px;
        }
        body {
            font-family: 'Times New Roman', Times, serif; /* Old Money Serif */
            background-color: #FDF5E6;
            color: #2C3E50;
            overflow: hidden; /* 防止整個頁面捲動 */
            user-select: none; /* 防止拖曳時選取文字 */
        }
        .sans-serif {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        /* Chip Animation */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .chip-enter {
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* 3D Chip Effect (Simplified for small size) */
        .chip-coin {
            box-shadow: 
                inset 0 0 0 1px #B8860B,
                inset 0 0 3px 2px rgba(0,0,0,0.3), 
                0 1px 2px rgba(0,0,0,0.3);
            background: radial-gradient(circle at 30% 30%, #1B4D3E, #0F2B23);
            font-family: 'Courier New', monospace;
            color: #D4AF37;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px; /* Text size inside chip */
        }
        .chip-coin::after {
            content: '$'; /* Simple symbol */
            text-shadow: 0 1px 1px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body class="h-screen w-screen flex items-center justify-center bg-[#FDF5E6]">
    <div id="root" class="w-full h-full flex items-center justify-center"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons
        const IconTrendingUp = ({ size = 14, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
        );
        const IconTrendingDown = ({ size = 14, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></svg>
        );
        const IconPieChart = ({ size = 14, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
        );
        const IconRotateCcw = ({ size = 14, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>
        );
        const IconLock = ({ size = 14, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        );
        const IconCoins = ({ size = 14, className }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="8" r="6"></circle><path d="M18.09 10.37A6 6 0 1 1 10.34 18"></path><path d="M7 6h1v4"></path><path d="m16.71 13.88.7.71-2.82 2.82"></path></svg>
        );

        // Data
        const STOCK_DATA = [
            { id: '2330', name: '台積電', startPrice: 1075, endPrice: 1550, desc: '晶片龍頭' },
            { id: '2317', name: '鴻海', startPrice: 184.0, endPrice: 230.5, desc: 'AI伺服器' },
            { id: '2308', name: '台達電', startPrice: 435.0, endPrice: 963.0, desc: '電源散熱' },
            { id: '2454', name: '聯發科', startPrice: 1415, endPrice: 1430, desc: 'IC設計' },
            { id: '2881', name: '富邦金', startPrice: 91.3, endPrice: 97.0, desc: '金控獲利' },
            { id: '2882', name: '國泰金', startPrice: 68.3, endPrice: 76.2, desc: '壽險雙雄' },
            { id: '2382', name: '廣達', startPrice: 285.5, endPrice: 272.0, desc: '伺服器' },
            { id: '2412', name: '中華電', startPrice: 123.5, endPrice: 130.5, desc: '電信防禦' },
            { id: '3711', name: '日月光', startPrice: 163.5, endPrice: 252.0, desc: '封測龍頭' },
            { id: '2891', name: '中信金', startPrice: 39.1, endPrice: 50.2, desc: '消費金融' },
        ];

        const CHIP_VALUE = 100000;
        const TOTAL_CHIPS = 10;
        const TOTAL_BUDGET = 1000000;

        // Component: Single Chip
        const Chip = ({ id, onDragStart }) => {
            return (
                <div
                    draggable="true"
                    onDragStart={(e) => onDragStart && onDragStart(e, id)}
                    className="w-7 h-7 rounded-full chip-coin cursor-grab active:cursor-grabbing hover:scale-110 transition-transform chip-enter shrink-0"
                    title="拖曳我！價值 $100,000"
                >
                </div>
            );
        };

        const TaiwanStockSimulator2025 = () => {
            // State: Number of chips on each stock index (0-9)
            // Initial state: 0 chips on stocks, all in bank
            const [stockChips, setStockChips] = useState(Array(STOCK_DATA.length).fill(0));
            
            // Computed: Bank chips
            const chipsInBank = TOTAL_CHIPS - stockChips.reduce((a, b) => a + b, 0);

            const [finalValue, setFinalValue] = useState(0);
            const [totalProfit, setTotalProfit] = useState(0);

            const getReturnRate = (stock) => (stock.endPrice - stock.startPrice) / stock.startPrice;

            useEffect(() => {
                let currentFinal = 0;
                
                stockChips.forEach((count, index) => {
                    const amount = count * CHIP_VALUE;
                    const stock = STOCK_DATA[index];
                    const growthRate = getReturnRate(stock);
                    
                    if (amount > 0) {
                        currentFinal += amount * (1 + growthRate);
                    }
                });
                
                // Uninvested cash stays as cash (no growth)
                const cash = chipsInBank * CHIP_VALUE;
                currentFinal += cash;

                setFinalValue(currentFinal);
                // Profit is based on the 1M budget vs Final Value
                setTotalProfit(currentFinal - TOTAL_BUDGET);
            }, [stockChips, chipsInBank]);

            // Drag Handlers
            const handleDragStart = (e, source, index) => {
                // source: 'bank' or 'stock'
                // index: stock index (if source is stock)
                e.dataTransfer.setData("sourceType", source);
                if (index !== undefined) e.dataTransfer.setData("sourceIndex", index);
                e.dataTransfer.effectAllowed = "move";
            };

            const handleDrop = (e, targetType, targetIndex) => {
                e.preventDefault();
                const sourceType = e.dataTransfer.getData("sourceType");
                const sourceIndex = parseInt(e.dataTransfer.getData("sourceIndex"));

                if (sourceType === 'bank' && targetType === 'stock') {
                    // Bank -> Stock
                    if (chipsInBank > 0) {
                        const newStockChips = [...stockChips];
                        newStockChips[targetIndex]++;
                        setStockChips(newStockChips);
                    }
                } else if (sourceType === 'stock' && targetType === 'bank') {
                    // Stock -> Bank
                    const newStockChips = [...stockChips];
                    if (newStockChips[sourceIndex] > 0) {
                        newStockChips[sourceIndex]--;
                        setStockChips(newStockChips);
                    }
                } else if (sourceType === 'stock' && targetType === 'stock') {
                    // Stock -> Stock
                    if (sourceIndex === targetIndex) return;
                    const newStockChips = [...stockChips];
                    if (newStockChips[sourceIndex] > 0) {
                        newStockChips[sourceIndex]--;
                        newStockChips[targetIndex]++;
                        setStockChips(newStockChips);
                    }
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = "move";
            };

            const handleReset = () => {
                setStockChips(Array(STOCK_DATA.length).fill(0));
            };

            const formatCurrency = (val) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(val);
            const formatNumber = (val) => new Intl.NumberFormat('zh-TW').format(Math.round(val));
            const formatPrice = (val) => new Intl.NumberFormat('zh-TW', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(val);

            return (
                <div className="w-full max-w-[800px] max-h-[600px] h-full bg-[#FFFAF0] border-4 border-[#1B4D3E] shadow-2xl relative overflow-hidden flex flex-col box-border">
                    {/* Top Decor */}
                    <div className="h-1.5 w-full bg-[#1B4D3E] shrink-0"></div>
                    <div className="h-0.5 w-full bg-[#D4AF37] mt-0.5 shrink-0"></div>

                    {/* Header */}
                    <header className="bg-[#F5F5DC] px-4 py-2 border-b border-[#E0D6C2] shrink-0 select-none">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold tracking-wider text-[#1B4D3E] font-serif leading-none">
                                    TWSE '25
                                </h1>
                                <p className="text-[#8B7355] italic text-[10px] tracking-widest uppercase mt-0.5">
                                    Chip Asset Simulation
                                </p>
                            </div>

                            <div className="flex gap-2">
                                {/* Profit */}
                                <div className="bg-white/60 px-2 py-1 border border-[#D3D3D3] w-24 rounded-sm">
                                     <div className="flex items-center gap-1 text-[#8B7355] text-[9px] uppercase tracking-wider">
                                       {totalProfit >= 0 ? <IconTrendingUp size={10} /> : <IconTrendingDown size={10} />} Profit
                                     </div>
                                     <div className={`text-sm font-bold font-mono leading-none mt-0.5 ${totalProfit >= 0 ? 'text-[#1B4D3E]' : 'text-red-500'}`}>
                                       {totalProfit > 0 ? '+' : ''}{formatNumber(totalProfit)}
                                     </div>
                                </div>
                                {/* Final */}
                                <div className="bg-[#1B4D3E] px-3 py-1 border border-[#D4AF37] text-white w-32 shadow rounded-sm">
                                    <div className="flex items-center gap-1 text-[#D4AF37] text-[9px] uppercase tracking-wider">
                                      <IconPieChart size={10} /> Year End
                                    </div>
                                    <div className="text-lg font-bold text-[#D4AF37] font-mono leading-none mt-0.5">
                                      {formatCurrency(finalValue)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="px-4 py-2 bg-[#FFFAF0] flex-1 flex flex-col min-h-0 relative">
                        <div className="flex justify-between items-center mb-1 shrink-0">
                            <h2 className="text-sm font-bold text-[#2C1B18] border-b border-[#D4AF37] inline-block pb-0.5">
                                股票配置區 (拖曳籌碼至此)
                            </h2>
                            <button onClick={handleReset} className="flex items-center gap-1 px-2 py-0.5 text-[10px] border border-[#8B7355] text-[#8B7355] hover:bg-[#1B4D3E] hover:text-[#D4AF37] transition-colors rounded-sm uppercase tracking-wider bg-white cursor-pointer shadow-sm">
                                <IconRotateCcw size={10} /> 收回所有籌碼
                            </button>
                        </div>

                        {/* Stock Grid */}
                        <div className="grid grid-cols-5 gap-2 flex-1 min-h-0 mb-2">
                            {STOCK_DATA.map((stock, index) => {
                                const chipCount = stockChips[index];
                                const allocatedAmount = chipCount * CHIP_VALUE;
                                
                                return (
                                    <div 
                                        key={stock.id}
                                        onDragOver={handleDragOver}
                                        onDrop={(e) => handleDrop(e, 'stock', index)}
                                        className={`relative bg-white border border-[#E0D6C2] p-1.5 transition-all rounded-sm flex flex-col h-full overflow-hidden
                                            ${chipCount > 0 ? 'border-[#D4AF37] shadow-md bg-[#FFFDF5]' : 'hover:border-[#8B7355]'}
                                        `}
                                    >
                                        {/* Header */}
                                        <div className="flex justify-between items-start mb-1 shrink-0 pointer-events-none">
                                            <div>
                                                <span className="block text-[10px] font-bold text-[#1B4D3E] leading-none">{stock.id}</span>
                                                <span className="block text-sm font-bold text-[#2C1B18] leading-tight truncate w-20" title={stock.name}>{stock.name}</span>
                                            </div>
                                            <div className="bg-gray-100 text-gray-400 p-0.5 rounded">
                                                <IconLock size={10} />
                                            </div>
                                        </div>

                                        {/* Prices */}
                                        <div className="flex justify-between text-[9px] text-gray-500 mb-1 pb-1 border-b border-dotted border-gray-200 shrink-0 pointer-events-none">
                                            <div>
                                                <div className="uppercase tracking-tighter opacity-70">Open</div>
                                                <div className="font-mono text-[#5D5D5D]">${formatPrice(stock.startPrice)}</div>
                                            </div>
                                            <div className="text-right opacity-50">
                                                 <div className="uppercase tracking-tighter opacity-70">Close</div>
                                                 <div className="font-mono font-bold text-[#2C1B18]">???</div>
                                            </div>
                                        </div>

                                        {/* Drop Zone / Chip Container (Horizontal Layout) */}
                                        <div className="flex-1 overflow-y-auto overflow-x-hidden min-h-0 py-1">
                                            {chipCount === 0 ? (
                                                <div className="h-full w-full border-2 border-dashed border-gray-200 rounded flex items-center justify-center opacity-50">
                                                    <span className="text-[8px] text-gray-400">Drag Here</span>
                                                </div>
                                            ) : (
                                                <div className="flex flex-wrap gap-1 content-start justify-start">
                                                    {Array.from({ length: chipCount }).map((_, i) => (
                                                        <Chip 
                                                            key={i}
                                                            id={`stock-${index}-${i}`} 
                                                            onDragStart={(e) => handleDragStart(e, 'stock', index)}
                                                        />
                                                    ))}
                                                </div>
                                            )}
                                        </div>

                                        {/* Amount Footer */}
                                        <div className="mt-auto pt-1 border-t border-dashed border-[#E0D6C2] shrink-0 text-center pointer-events-none">
                                            <span className={`font-mono text-xs font-bold ${allocatedAmount > 0 ? 'text-[#1B4D3E]' : 'text-gray-300'}`}>
                                                ${formatNumber(allocatedAmount)}
                                            </span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        
                        {/* Bank Area (Sideline) */}
                        <div 
                            className="h-16 bg-[#E8E0C9] border-t-2 border-[#C0B283] flex flex-col items-center justify-center shrink-0 rounded-t-lg shadow-inner relative"
                            onDragOver={handleDragOver}
                            onDrop={(e) => handleDrop(e, 'bank')}
                        >
                            <div className="absolute top-1 left-2 text-[#8B7355] text-[10px] uppercase font-bold flex items-center gap-1">
                                <IconCoins size={10} /> 資金池
                            </div>
                            
                            {/* Chips Container */}
                            <div className="flex gap-1 items-center justify-center w-full px-4 pt-3 flex-wrap">
                                {chipsInBank === 0 ? (
                                    <div className="text-gray-400 text-xs italic font-serif">
                                        All In
                                    </div>
                                ) : (
                                    Array.from({ length: chipsInBank }).map((_, i) => (
                                        <div key={`bank-chip-${i}`} >
                                            <Chip 
                                                id={`bank-${i}`} 
                                                onDragStart={(e) => handleDragStart(e, 'bank')} 
                                            />
                                        </div>
                                    ))
                                )}
                            </div>
                            
                            <div className="absolute bottom-1 right-2 text-[#5D5D5D] font-mono text-xs font-bold">
                                剩餘: ${formatNumber(chipsInBank * CHIP_VALUE)}
                            </div>
                        </div>

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TaiwanStockSimulator2025 />);
    </script>
</body>
</html>
