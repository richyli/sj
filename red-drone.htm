<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¢æ½®è¡ŒåŠ¨ï¼šæ— äººæœºæ”»å°æ¨æ¼”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@700;900&family=Noto+Sans+TC:wght@400;700&display=swap');

        /* å…¨å±€è®Šé‡ - è§£æ”¾è»é…è‰² */
        :root {
            --pla-red: #ff0000;
            --pla-yellow: #ffff00;
            --pla-green: #004d00;
            --pla-bg: #0a1a0a;
            --tw-blue: #0033cc;
        }

        body {
            background-color: var(--pla-bg);
            color: var(--pla-yellow);
            font-family: 'Noto Serif SC', 'SimSun', serif;
            overflow-x: hidden;
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        /* CRT è¢å¹•æƒæç·šæ•ˆæœ */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .crt {
            animation: textShadow 1.6s infinite;
        }

        /* ç²—æš´çš„æŒ‰éˆ•é¢¨æ ¼ */
        .btn-pla {
            background-color: var(--pla-red);
            color: var(--pla-yellow);
            border: 4px solid var(--pla-yellow);
            font-size: 1.25rem;
            font-weight: 900;
            padding: 1.5rem 1rem;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 5px 5px 0px var(--pla-green);
            text-transform: uppercase;
            letter-spacing: 2px;
            white-space: pre-line; /* å…è¨±æ›è¡Œ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .btn-pla:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--pla-green);
            background-color: #cc0000;
        }

        .btn-pla:active {
            transform: translate(5px, 5px);
            box-shadow: none;
        }

        /* æˆ°è¡“åœ°åœ–æ¡† */
        .tactical-map {
            border: 4px dashed var(--pla-red);
            background-color: #002200;
            background-image: radial-gradient(var(--pla-green) 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
        }

        /* æ–‡å­—é–ƒçˆ */
        .blink {
            animation: blinker 1s linear infinite;
        }

        @keyframes blinker {
            50% { opacity: 0; }
        }

        /* åˆ†æå ±å‘Šæ¨¡å¼ (å°ç£è¦–è§’) */
        .analysis-mode {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f0f0;
            color: #333;
        }
        
        .analysis-card {
            background: white;
            border-left: 8px solid var(--tw-blue);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .hidden { display: none !important; }
        
        /* æ¨™é¡Œå­—ç‰¹æ•ˆ */
        .propaganda-text {
            text-shadow: 3px 3px 0px var(--pla-red);
            transform: skew(-5deg);
        }

        .stamp {
            border: 3px solid var(--pla-red);
            color: var(--pla-red);
            padding: 0.5rem;
            transform: rotate(-10deg);
            display: inline-block;
            font-weight: bold;
            font-size: 1.5rem;
            opacity: 0;
            animation: stamp-in 0.5s forwards ease-in;
        }

        @keyframes stamp-in {
            0% { opacity: 0; transform: scale(3) rotate(-10deg); }
            100% { opacity: 1; transform: scale(1) rotate(-10deg); }
        }

    </style>
</head>
<body class="crt">

    <!-- éŠæˆ²ä¸»å®¹å™¨ -->
    <div id="game-container" class="flex-grow flex flex-col p-4 max-w-2xl mx-auto w-full h-full justify-center">
        
        <!-- é ‚éƒ¨ç‹€æ…‹æ¬„ -->
        <div class="flex justify-between border-b-4 border-red-600 pb-2 mb-4 font-bold text-xl">
            <span class="text-red-500">ä¸œéƒ¨æˆ˜åŒº // æ— äººæœºä½œæˆ˜æ—…</span>
            <span id="status-text" class="blink text-yellow-300">ç­‰å¾…æŒ‡ä»¤...</span>
        </div>

        <!-- å…§å®¹é¡¯ç¤ºå€ -->
        <div id="content-area" class="flex-grow flex flex-col items-center justify-center text-center space-y-6">
            <!-- å‹•æ…‹æ³¨å…¥å…§å®¹ -->
        </div>

    </div>

    <!-- å°ç£è¦–è§’åˆ†æå ±å‘Š (é è¨­éš±è—) -->
    <div id="debrief-container" class="hidden analysis-mode absolute inset-0 z-50 overflow-y-auto p-6">
        <div class="max-w-2xl mx-auto space-y-6">
            <div class="bg-blue-900 text-white p-6 rounded-lg shadow-lg">
                <h1 class="text-2xl font-bold mb-2">ğŸ›¡ï¸ åœ‹é˜²å®‰å…¨åˆ†æå ±å‘Š</h1>
                <p class="text-blue-200">ä¾†æºï¼šç„¡äººæ©Ÿæ”»é˜²æ¨¡æ“¬ç³»çµ±</p>
            </div>
            
            <div id="debrief-content" class="space-y-4">
                <!-- åˆ†æå…§å®¹ç”± JS æ³¨å…¥ -->
            </div>

            <button onclick="location.reload()" class="w-full bg-gray-800 text-white py-4 rounded-lg font-bold hover:bg-gray-700 transition">
                é‡æ–°é–‹å§‹æ¨¡æ“¬
            </button>
        </div>
    </div>

    <script>
        // --- éŠæˆ²æ•¸æ“šé…ç½® ---
        
        const scenarios = [
            {
                title: "å‰çº¿éªšæ‰°",
                target: "é‡‘é—¨å“¨æ‰€",
                desc: "åˆ¶é€ å°å²›ç¤¾ä¼šææ…Œï¼Œæµ‹è¯•æ•Œå†›ååº”ï¼Œä½†ä¸å¸Œæœ›å¼•çˆ†å…¨é¢æˆ˜äº‰ã€‚",
                options: [
                    {
                        label: "æ´¾é£\nåŒå°¾èå¤§å‹å¯Ÿæ‰“æ— äººæœº",
                        subtext: "æŒ‚è½½é‡å‹å¯¼å¼¹",
                        isCorrect: false,
                        resultTitle: "ä»»åŠ¡å¤±è´¥ï¼æ„šè ¢ï¼",
                        resultDetail: "æ€é¸¡ç„‰ç”¨ç‰›åˆ€ï¼æ´¾å‡ºå¤§å‹å†›æœºç›´æ¥è¢«é›·è¾¾é”å®šï¼Œç¾å†›èˆªæ¯ä»¥æ­¤ä¸ºå€Ÿå£ä»‹å…¥ï¼Œä¸§å¤±æˆ˜ç•¥æ¨¡ç³Šç©ºé—´ï¼",
                        lesson: "æ®ºé›ç”¨ç‰›åˆ€ï¼Œåé­åœ‹éš›ä»‹å…¥ã€‚ç°è‰²åœ°å¸¶è¡çªæ‡‰åˆ©ç”¨ã€Œæ°‘ç”¨æ©Ÿã€çš„ä½æ•æ„Ÿæ€§èˆ‡ä½æˆæœ¬å„ªå‹¢ã€‚"
                    },
                    {
                        label: "æ´¾é£\næ”¹è£…æ°‘ç”¨å››è½´æœº",
                        subtext: "æŒ‚è½½ä¼ å•ä¸åƒåœ¾",
                        isCorrect: true,
                        resultTitle: "æˆ˜æœ¯æˆåŠŸï¼",
                        resultDetail: "æ°‘ç”¨æœºé£è¶Šå“¨æ‰€ï¼Œè§†é¢‘ä¸Šä¼ æŠ–éŸ³å¼•å‘å°å²›èˆ†è®ºå¤§ä¹±ï¼æˆæœ¬æä½ï¼Œå¯¹æ–¹æ‰“ä¹Ÿä¸æ˜¯ï¼Œä¸æ‰“ä¹Ÿä¸æ˜¯ï¼",
                        lesson: "åˆ©ç”¨å»‰åƒ¹å•†ç”¨æ©Ÿé€²è¡Œã€ŒèªçŸ¥ä½œæˆ°ã€ï¼Œè®“å®ˆè»é™·å…¥ã€Œæ¶ˆè€—é£›å½ˆå¤ªè²´ã€ä¸æ‰“åˆè¢«ç¬‘ç„¡èƒ½ã€çš„å…©é›£ã€‚"
                    }
                ]
            },
            {
                title: "æ‘§æ¯è€³ç›®",
                target: "æœ¬å²›é›·è¾¾ç«™",
                desc: "å¼€æˆ˜å‰å¤•ï¼ˆD-Day -2hrï¼‰ï¼Œå¿…é¡»è‡´ç›²æ•Œé˜²ç©ºé›·è¾¾ï¼Œä¸ºåç»­æˆ˜æœºå¼€è·¯ã€‚",
                options: [
                    {
                        label: "å•æ¶\né«˜ç©ºéšå½¢ä¾¦å¯Ÿæœº (æ— ä¾¦-7)",
                        subtext: "é«˜ç©ºä¾¦æŸ¥å¼•å¯¼",
                        isCorrect: false,
                        resultTitle: "è¢«å‡»è½ï¼",
                        resultDetail: "å°å²›é˜²ç©ºå¯†åº¦ä¸–ç•Œç¬¬äºŒï¼å•æœºçªé˜²ç­‰äºé€æ­»ï¼ä¸€æšå¯¼å¼¹æ¢æ‰æˆ‘æ–¹é«˜ä»·å€¼å†›æœºï¼Œäºæœ¬ï¼",
                        lesson: "å°ç£é˜²ç©ºç¶²æ¥µç‚ºå¯†é›†ï¼Œå–®ä¸€é«˜åƒ¹å€¼ç„¡äººæ©Ÿç”Ÿå­˜ç‡ä½ï¼Œå®¹æ˜“è¢«æ„›åœ‹è€…æˆ–å¤©å¼“é£›å½ˆé–å®šæ“Šè½ã€‚"
                    },
                    {
                        label: "äº”ç™¾æ¶\nè‡ªæ€å¼æ— äººæœºèœ‚ç¾¤",
                        subtext: "ä½ç©ºé¥±å’Œæ”»å‡»",
                        isCorrect: true,
                        resultTitle: "æ¯ç­æ‰“å‡»ï¼",
                        resultDetail: "æ•Œå†›ä¸€æšå¤©å¼“å¯¼å¼¹é€ ä»·æ•°åƒä¸‡ï¼Œæˆ‘æœ‰500æ¶å»‰ä»·æ— äººæœºï¼äº¤æ¢æ¯”å¤§èƒœï¼é›·è¾¾ç«™å› ç›®æ ‡è¿‡å¤šè€Œè¿‡è½½ï¼",
                        lesson: "ã€Œä¸å°ç¨±ä½œæˆ°ã€æ ¸å¿ƒï¼šç”¨å¤§é‡å»‰åƒ¹è‡ªæ®ºç„¡äººæ©Ÿï¼ˆLoitering Munitionï¼‰æ¶ˆè€—æ˜‚è²´çš„é˜²ç©ºé£›å½ˆï¼ˆæˆæœ¬äº¤æ›æ¯”ï¼‰ã€‚"
                    }
                ]
            },
            {
                title: "ä¾›åº”é“¾æ–­ä¾›",
                target: "æ— äººæœºç»„è£…å‚",
                desc: "æˆ˜äº‹èƒ¶ç€ï¼Œåº“å­˜æ— äººæœºè€—å°½ï¼Œæ€¥éœ€ç”Ÿäº§æ–°æœºè¡¥å……å‰çº¿ã€‚",
                options: [
                    {
                        label: "é‡‡è´­\né«˜æ€§èƒ½è¿›å£èŠ¯ç‰‡",
                        subtext: "æ€§èƒ½æå‡ 300%",
                        isCorrect: false,
                        resultTitle: "ç”Ÿäº§çº¿åœæ‘†ï¼",
                        resultDetail: "è¥¿æ–¹å›½å®¶å®æ–½æŠ€æœ¯å°é”ï¼è¿›å£èŠ¯ç‰‡å…¨éƒ¨æ–­ä¾›ï¼æ— äººæœºæ— æ³•å‡ºè´§ï¼Œå‰çº¿å´©æºƒï¼",
                        lesson: "éåº¦è¿½æ±‚æ€§èƒ½è€Œä¾è³´å¤–åœ‹æ™¶ç‰‡ï¼Œæˆ°æ™‚å®¹æ˜“é¢è‡¨ã€Œæ–·ä¾›ã€é¢¨éšªã€‚è‡ªä¸»å¯æ§çš„ä¾›æ‡‰éˆæ¯”é«˜æ€§èƒ½æ›´é‡è¦ã€‚"
                    },
                    {
                        label: "ä½¿ç”¨\nå›½äº§åº“å­˜ä½é˜¶èŠ¯ç‰‡",
                        subtext: "æ€§èƒ½ä¸€èˆ¬",
                        isCorrect: true,
                        resultTitle: "æºæºä¸æ–­ï¼",
                        resultDetail: "è™½ç„¶æ€§èƒ½å¹³åº¸ï¼Œä½†ä¸å—åˆ¶è£å½±å“ï¼æˆåƒä¸Šä¸‡æ¶æ— äººæœºæŒç»­ä¸‹çº¿ï¼Œæ‹–å®æ•Œäººï¼",
                        lesson: "ç¢ºä¿ä¾›æ‡‰éˆã€Œå»ç¾åŒ–ã€æˆ–ã€Œè‡ªä¸»åŒ–ã€ï¼Œå³ä½¿æ•ˆèƒ½è¼ƒå·®ï¼Œä¹Ÿèƒ½ä¿è­‰æˆ°æ™‚ç”Ÿç”¢ä¸ä¸­æ–·ï¼ˆå¦‚ä¿„çƒæˆ°çˆ­ä¸­çš„ä¼Šæœ—ç„¡äººæ©Ÿï¼‰ã€‚"
                    }
                ]
            },
            {
                title: "æ–©é¦–è¡ŒåŠ¨",
                target: "å°åŒ—æŒ‡æŒ¥æ‰€",
                desc: "æ•Œå†›å¼€å¯å…¨é¢‘æ®µç”µå­å¹²æ‰°ï¼ˆJammingï¼‰ï¼Œå¿…é¡»å¯¹å¸‚åŒºç›®æ ‡è¿›è¡Œç²¾ç¡®æ‰“å‡»ã€‚",
                options: [
                    {
                        label: "ä½¿ç”¨\nå•†ç”¨å›¾ä¼  + GPSå¯¼èˆª",
                        subtext: "ä¿¡å·ç¨³å®š",
                        isCorrect: false,
                        resultTitle: "å…¨å‘˜é˜µäº¡ï¼",
                        resultDetail: "æ•Œå†›å¼€å¯GPSå¹²æ‰°ï¼ä¸”å¤§ç–†æ— äººæœºå¹¿æ’­äº†ä½ ï¼ˆé£æ‰‹ï¼‰çš„ä½ç½®ï¼è¿«å‡»ç‚®è¦†ç›–ï¼Œä½ æ­»äº†ï¼",
                        lesson: "å•†ç”¨æ©Ÿéåº¦ä¾è³´ GPS ä¸”æœƒå»£æ’­é£›æ‰‹ä½ç½® (AeroScope æ¼æ´)ï¼Œæˆ°æ™‚æ˜“è¢«å¹²æ“¾ä¸¦åå‘å®šä½æ“ä½œè€…ã€‚"
                    },
                    {
                        label: "ä½¿ç”¨\nAI è§†è§‰è‡ªä¸»å¯¼èˆª",
                        subtext: "å…¨é™é»˜é£è¡Œ",
                        isCorrect: true,
                        resultTitle: "æ–©é¦–æˆåŠŸï¼",
                        resultDetail: "æ— è§†ç”µå­å¹²æ‰°ï¼ä¸éœ€è¦GPSï¼AI èŠ¯ç‰‡ä¾é æ‘„åƒå¤´è¯†åˆ«åœ°å½¢ä¸ç›®æ ‡ï¼Œç²¾å‡†å‘½ä¸­ï¼",
                        lesson: "çœŸæ­£çš„å¨è„…ä¾†è‡ªå…·å‚™ã€Œè¦–è¦ºå°èˆªã€èˆ‡ã€Œè‡ªä¸»é‹ç®—ã€çš„é«˜éšç„¡äººæ©Ÿï¼Œä¸ä¾è³´å¤–éƒ¨è¨Šè™Ÿï¼Œé›£ä»¥è¢«é›»å­å¹²æ“¾ã€‚"
                    }
                ]
            },
            {
                title: "å¤œé—´çªè¢­",
                target: "å…³é”®å˜ç”µæ‰€",
                desc: "å¤œé—´è¡ŒåŠ¨ï¼Œéœ€è¦æ— äººæœºåœ¨é»‘æš—ä¸­é¿å¼€ç”µçº¿å¹¶æ‰¾åˆ°ç›®æ ‡ã€‚",
                options: [
                    {
                        label: "å¼€å¯\nä¸»åŠ¨é›·è¾¾ / æ¢ç…§ç¯",
                        subtext: "çœ‹å¾—æ¸…æ¥š",
                        isCorrect: false,
                        resultTitle: "æš´éœ²ç›®æ ‡ï¼",
                        resultDetail: "ä½ çš„ä¸»åŠ¨é›·è¾¾ä¿¡å·åœ¨å¤œç©ºä¸­åƒç¯å¡”ä¸€æ ·è€€çœ¼ï¼è¢«æ•Œæ–¹ç”µå­ä¾¦å¯Ÿè½¦æ•è·ï¼ŒæœªæŠµè¾¾å³è¢«å‡»è½ï¼",
                        lesson: "åœ¨ç¾ä»£æˆ°å ´ï¼Œç™¼å‡ºä¸»å‹•è¨Šè™Ÿï¼ˆå¦‚é›·é”æ³¢æˆ–å¼·å…‰ï¼‰ç­‰æ–¼è‡ªæ®ºã€‚è¢«å‹•å¼æ„Ÿæ¸¬å™¨ï¼ˆå¦‚ç†±æˆåƒï¼‰æ‰æ˜¯ç”Ÿå­˜ä¹‹é“ã€‚"
                    },
                    {
                        label: "ä½¿ç”¨\nçº¢å¤–çº¿çƒ­æˆåƒ (Passive)",
                        subtext: "è¢«åŠ¨æ¥æ”¶",
                        isCorrect: true,
                        resultTitle: "ä»»åŠ¡è¾¾æˆï¼",
                        resultDetail: "é™æ‚„æ‚„åœ°æ¥è¿‘... å˜ç”µæ‰€çš„çƒ­é‡åœ¨çƒ­æˆåƒä¸­æ¸…æ™°å¯è§ï¼æ’å‡»æˆåŠŸï¼Œå…¨å°å¤§åœç”µï¼",
                        lesson: "ç†±æˆåƒèˆ‡è¢«å‹•æ„Ÿæ¸¬æŠ€è¡“æ˜¯å¤œé–“ä½œæˆ°é—œéµï¼Œé€™ä¹Ÿæ˜¯ç‚ºä½•ç›¸é—œé¡é ­æ¨¡çµ„å±¬æ–¼åš´æ ¼ç®¡åˆ¶çš„æˆ°ç•¥ç‰©è³‡ã€‚"
                    }
                ]
            }
        ];

        // --- éŠæˆ²é‚è¼¯ ---

        const state = {
            step: 0,
            history: [],
            currentOptions: [] // å­˜å„²ç•¶å‰éš¨æ©Ÿæ’åºå¾Œçš„é¸é …
        };

        const container = document.getElementById('content-area');
        const statusText = document.getElementById('status-text');
        const gameContainer = document.getElementById('game-container');
        const debriefContainer = document.getElementById('debrief-container');
        const debriefContent = document.getElementById('debrief-content');

        // æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function vibrate() {
            if (navigator.vibrate) navigator.vibrate(50);
            gameContainer.style.transform = "translate(2px, 2px)";
            setTimeout(() => gameContainer.style.transform = "none", 100);
        }

        function renderStep() {
            container.innerHTML = '';
            
            // 0. é–‹å§‹ç•«é¢
            if (state.step === 0) {
                statusText.innerText = "ä¸€çº§æˆ˜å¤‡";
                statusText.className = "blink text-red-500";
                container.innerHTML = `
                    <h1 class="text-6xl font-black text-yellow-300 propaganda-text mb-8">çº¢æ½®è¡ŒåŠ¨</h1>
                    <div class="tactical-map w-64 h-48 mb-6 flex items-center justify-center">
                        <span class="text-4xl">ğŸ—ºï¸ ğŸ‡¹ğŸ‡¼</span>
                    </div>
                    <p class="text-xl font-bold mb-8 text-red-400">
                        ç›®æ ‡ï¼šä»¥æœ€å°ä»£ä»·<br>ç˜«ç—ªå°å²›é˜²å¾¡ä½“ç³»
                    </p>
                    <button onclick="nextStep()" class="btn-pla w-full">
                        å¼€å§‹ä½œæˆ˜æŒ‡ä»¤
                    </button>
                `;
                return;
            }

            // 1~N. éŠæˆ²é—œå¡
            if (state.step <= scenarios.length) {
                const scenario = scenarios[state.step - 1];
                statusText.innerText = `åœºæ™¯ ${state.step}ï¼š${scenario.title}`;
                
                // æº–å‚™é¸é …ä¸¦éš¨æ©ŸåŒ– (å¦‚æœé‚„æ²’æº–å‚™é)
                if (!state.currentOptions || state.currentOptions.length === 0) {
                    // è¤‡è£½é¸é …ä¸¦æ·»åŠ åŸå§‹ç´¢å¼•ä»¥ä¾¿è¿½è¹¤ï¼ˆé›–ç„¶é€™è£¡ç›´æ¥å­˜å°è±¡æ›´æ–¹ä¾¿ï¼‰
                    state.currentOptions = shuffleArray([...scenario.options]);
                }

                container.innerHTML = `
                    <div class="w-full text-left mb-4 border-l-4 border-yellow-300 pl-4">
                        <h2 class="text-2xl text-red-500 font-bold">ç›®æ ‡ï¼š${scenario.target}</h2>
                        <p class="text-lg leading-relaxed mt-2">${scenario.desc}</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full h-48">
                        ${state.currentOptions.map((opt, index) => `
                            <button onclick="resolveRound(${index})" class="btn-pla">
                                <span class="text-xl mb-2">${opt.label}</span>
                                <span class="text-xs text-green-300 opacity-60">${opt.subtext}</span>
                            </button>
                        `).join('')}
                    </div>
                `;
                return;
            }

            // End. çµç®—ç•«é¢
            container.innerHTML = `
                <h1 class="text-4xl font-black text-red-500 mb-4 blink">ä½œæˆ˜ç»“æŸ</h1>
                <p class="text-yellow-300 text-xl mb-6">æ­£åœ¨ç”Ÿæˆæˆ˜æŠ¥...</p>
                <div class="w-full h-2 bg-green-900 rounded">
                        <div class="h-full bg-red-500 animate-[width_2s_ease-in-out_forwards]" style="width: 100%"></div>
                </div>
            `;
            setTimeout(showDebrief, 2000);
        }

        function resolveRound(optionIndex) {
            vibrate();
            const scenario = scenarios[state.step - 1];
            const selectedOption = state.currentOptions[optionIndex];
            
            // è¨˜éŒ„æ­·å²
            state.history.push({
                stage: scenario.title,
                target: scenario.target,
                result: selectedOption.isCorrect ? "æˆåŠŸ" : "å¤±æ•—",
                lesson: selectedOption.lesson
            });

            const isWin = selectedOption.isCorrect;

            // é¡¯ç¤ºçµæœé 
            container.innerHTML = `
                <div class="border-4 ${isWin ? 'border-green-500' : 'border-red-500'} p-6 bg-black w-full">
                    <h1 class="text-4xl font-black ${isWin ? 'text-green-500' : 'text-red-500'} mb-4">${selectedOption.resultTitle}</h1>
                    <div class="${isWin ? 'text-green-300' : 'text-red-300'} text-xl font-bold mb-6 leading-relaxed">
                        ${selectedOption.resultDetail}
                    </div>
                    ${isWin ? '<div class="stamp border-green-500 text-green-500">æ‰¹å‡†</div>' : '<div class="stamp">æ•´æ”¹</div>'}
                </div>
                <button onclick="nextStep()" class="btn-pla w-full mt-6">
                    ${state.step === scenarios.length ? 'ç”Ÿæˆæˆ˜æŠ¥' : 'ä¸‹ä¸€é˜¶æ®µ'}
                </button>
            `;
        }

        function nextStep() {
            state.step++;
            state.currentOptions = []; // æ¸…ç©ºç•¶å‰é¸é …ï¼Œä»¥ä¾¿ä¸‹ä¸€é—œé‡æ–°éš¨æ©Ÿ
            renderStep();
        }

        function showDebrief() {
            document.body.classList.remove('crt');
            document.body.style.backgroundColor = '#f0f0f0';
            gameContainer.classList.add('hidden');
            debriefContainer.classList.remove('hidden');

            let reportHtml = '';
            let successCount = 0;
            
            state.history.forEach((item, index) => {
                const isSuccess = item.result === "æˆåŠŸ";
                if(isSuccess) successCount++;
                reportHtml += `
                    <div class="analysis-card p-4 rounded mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-lg text-gray-800">æƒ…å¢ƒ ${index + 1}: ${item.stage} (${item.target})</h3>
                            <span class="px-2 py-1 rounded text-sm ${!isSuccess ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                å…±è»çµæœï¼š${item.result}
                            </span>
                        </div>
                        <p class="text-gray-600 font-bold mb-1">ğŸ” å°ç£è¦–è§’è§£æï¼š</p>
                        <p class="text-gray-700 leading-relaxed">${item.lesson}</p>
                    </div>
                `;
            });

            // æ ¹æ“šåˆ†æ•¸çµ¦äºˆä¸åŒè©•èª
            let finalComment = "";
            if (successCount >= 4) {
                finalComment = "æ‚¨éå¸¸äº†è§£ç¾ä»£ç„¡äººæ©Ÿæˆ°çˆ­çš„é‚è¼¯ï¼Œé€™ä¹Ÿé¡¯ç¤ºäº†å°ç£é¢è‡¨çš„å¨è„…æœ‰å¤šéº¼åš´å³»ä¸”çœŸå¯¦ã€‚";
            } else {
                finalComment = "æ‚¨é¸æ“‡äº†è¼ƒç‚ºå‚³çµ±æˆ–æ˜‚è²´çš„æˆ°è¡“ã€‚ç¾ä»£æˆ°çˆ­è¬›ç©¶ã€Œä¸å°ç¨±ã€èˆ‡ã€Œè³‡å®‰ã€ï¼Œé«˜ç§‘æŠ€ä¸ä»£è¡¨å‹åˆ©ï¼Œé©æ‡‰æ€§æ‰æ˜¯é—œéµã€‚";
            }

            reportHtml += `
                <div class="bg-gray-800 text-white p-6 rounded-lg mt-8">
                    <h3 class="text-xl font-bold mb-4">ğŸ“° æ–°èå°ˆé¡Œçµèªï¼šå¾éŠæˆ²çœ‹ç¾å¯¦</h3>
                    <p class="text-gray-300 mb-4 italic">${finalComment}</p>
                    <div class="border-t border-gray-600 pt-4 mt-4">
                        <ul class="list-disc pl-5 space-y-3 text-gray-300">
                            <li>
                                <strong class="text-white">çœ‹ä¸è¦‹çš„æˆæœ¬ï¼š</strong> 
                                éŠæˆ²ä¸­æ‚¨å¯èƒ½ç™¼ç¾ï¼Œæœ‰æ™‚å€™ã€Œä¾¿å®œçš„æ°‘ç”¨æ©Ÿã€æ¯”æ˜‚è²´çš„è»æ©Ÿæ›´é›£çºã€‚é€™å°±æ˜¯ç‚ºä½•å¥§æ¦®ç§‘æŠ€ç­‰å°å» è¦åœ¨æ³°åœ‹å»ºç«‹ã€Œéç´…ä¾›æ‡‰éˆã€ï¼Œé¿å…å°ç£å¸‚å ´å……æ–¥æ½›åœ¨çš„æ•µæ–¹ã€Œæ„Ÿæ¸¬å™¨ã€ã€‚
                            </li>
                            <li>
                                <strong class="text-white">è³‡å®‰å³æ˜¯åæ¨™ï¼š</strong> 
                                ä¸€æ—¦ç„¡äººæ©Ÿçš„é€šè¨Šå”å®šè¢«ç ´è§£æˆ–åŸå» ç•™æœ‰å¾Œé–€ï¼Œæˆ°å ´ä¸Šçš„æ“ä½œå“¡å°±å¦‚åŒè£¸é«”ã€‚
                            </li>
                            <li>
                                <strong class="text-white">æ‡‰å°ä¹‹é“ï¼š</strong> 
                                å°ç£é™¤äº†ç™¼å±•ç„¡äººæ©Ÿï¼Œæ›´éœ€è¦æ™®åŠåç„¡äººæ©Ÿç³»çµ±ï¼ˆå¹²æ“¾æ§ã€é›·å°„ï¼‰ä»¥åŠå»ºç«‹è‡ªä¸»å¯æ§çš„ç”Ÿç”¢èƒ½åŠ›ã€‚
                            </li>
                        </ul>
                    </div>
                </div>
            `;

            debriefContent.innerHTML = reportHtml;
        }

        renderStep();

    </script>
</body>
</html>
